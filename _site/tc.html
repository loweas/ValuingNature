<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LoweMackenzie">
<meta name="dcterms.date" content="2025-09-21">

<title>Travel Cost – Valuing Nature NREM 691</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Valuing Nature NREM 691</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv.html"> 
<span class="menu-text">Contingent Valuation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dce.html"> 
<span class="menu-text">Discrete Choice</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./hm.html"> 
<span class="menu-text">Hedonic</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./tc.html" aria-current="page"> 
<span class="menu-text">Travel Cost</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://www.youtube.com/@Prof.Iguana" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-youtube"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/loweas/ValuingNature">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/loweas/ValuingNature/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#revealed-preferences-travel-cost" id="toc-revealed-preferences-travel-cost" class="nav-link active" data-scroll-target="#revealed-preferences-travel-cost">Revealed Preferences: Travel Cost</a>
  <ul class="collapse">
  <li><a href="#the-travel-cost-model-tcm" id="toc-the-travel-cost-model-tcm" class="nav-link" data-scroll-target="#the-travel-cost-model-tcm">The Travel Cost Model (TCM)</a>
  <ul class="collapse">
  <li><a href="#understanding-consumer-surplus" id="toc-understanding-consumer-surplus" class="nav-link" data-scroll-target="#understanding-consumer-surplus">Understanding Consumer Surplus</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#single-site" id="toc-single-site" class="nav-link" data-scroll-target="#single-site">Single Site</a>
  <ul class="collapse">
  <li><a href="#travel-distance-using-osrm" id="toc-travel-distance-using-osrm" class="nav-link" data-scroll-target="#travel-distance-using-osrm">Travel Distance using OSRM</a></li>
  <li><a href="#count-model" id="toc-count-model" class="nav-link" data-scroll-target="#count-model">Count Model</a>
  <ul class="collapse">
  <li><a href="#simple-wtp" id="toc-simple-wtp" class="nav-link" data-scroll-target="#simple-wtp">Simple WTP</a></li>
  </ul></li>
  <li><a href="#more-controls" id="toc-more-controls" class="nav-link" data-scroll-target="#more-controls">More Controls</a>
  <ul class="collapse">
  <li><a href="#wtp" id="toc-wtp" class="nav-link" data-scroll-target="#wtp">WTP</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multi-site" id="toc-multi-site" class="nav-link" data-scroll-target="#multi-site">Multi-Site</a>
  <ul class="collapse">
  <li><a href="#random-utility-models-rums" id="toc-random-utility-models-rums" class="nav-link" data-scroll-target="#random-utility-models-rums">Random Utility Models (RUMs)</a></li>
  </ul></li>
  <li><a href="#nrem-691-fall-2025" id="toc-nrem-691-fall-2025" class="nav-link" data-scroll-target="#nrem-691-fall-2025">NREM 691 Fall 2025</a>
  <ul class="collapse">
  <li><a href="#map-yosemite" id="toc-map-yosemite" class="nav-link" data-scroll-target="#map-yosemite">Map Yosemite</a></li>
  <li><a href="#reservations-data" id="toc-reservations-data" class="nav-link" data-scroll-target="#reservations-data">Reservations Data</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Travel Cost</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>LoweMackenzie </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="revealed-preferences-travel-cost" class="level1">
<h1>Revealed Preferences: Travel Cost</h1>
<p>The <strong>Travel Cost Method (TCM)</strong> is a commonly used approach to estimate the value of recreation sites. It was first suggested by <a href="https://www.economia.unam.mx/profesores/blopez/valoracion-hotelling.pdf">Harold Hotelling in a 1947 letter to the National Park Service</a> and then further defined by Marion Clawson <span class="citation" data-cites="methods1972">(<a href="#ref-methods1972" role="doc-biblioref"><span>“Methods of Measuring the Demand for and Value of Outdoor Recreation. Marion Clawson. Resources for the Future, Inc., 1145 Nineteenth Street, N.W., Washington, D.C. 1959. 36p. 50c”</span> 1972</a>)</span>. It provides a <u><strong>lower-bound estimate</strong></u> of how much people value a site based on the cost they incur to visit.</p>
<p>There are two main types of TCM models:</p>
<section id="single-site-models" class="level4">
<h4 class="anchored" data-anchor-id="single-site-models">1. Single-Site Models</h4>
<ul>
<li><p>Focus on one specific location.</p></li>
<li><p>Use <strong>Poisson regression</strong> to estimate how many trips people take.</p></li>
<li><p>From this, you can calculate <strong>consumer surplus</strong> the benefit people get from visiting beyond what they pay.</p>
<p><img src="images/Picture1.png" class="img-fluid"></p></li>
<li><p>The cost of a trip includes actual expenses and the opportunity cost of travel time.</p></li>
<li><p>These models are best when you want to estimate the total value of a site. For example, if a park is closed due to pollution or budget cuts and you want to estimate the loss in value from that closure.</p></li>
</ul>
</section>
<section id="multi-site-or-multi-attribute-models" class="level4">
<h4 class="anchored" data-anchor-id="multi-site-or-multi-attribute-models">2. Multi-Site (or Multi-Attribute) Models</h4>
<ul>
<li><p>Focus on multiple sites or on different features (attributes) of sites.</p></li>
<li><p>Use random utility models, typically estimated with a mixed logit (random parameter logit) model.</p></li>
<li><p>These models help estimate how much people value different features, like trails, toilets, or accommodation.</p></li>
<li><p>Useful for park planning, as they help managers decide which improvements provide the most value to visitors.</p></li>
</ul>
<hr>
</section>
<section id="the-travel-cost-model-tcm" class="level2">
<h2 class="anchored" data-anchor-id="the-travel-cost-model-tcm">The Travel Cost Model (TCM)</h2>
<p>General Steps in the Travel Cost Modeling Process:</p>
<ol type="1">
<li><p><strong>Define the site</strong> to be evaluated</p></li>
<li><p><strong>Identify the types of recreation</strong> and specify the relevant season</p></li>
<li><p><strong>Develop a sampling strategy</strong> for data collection</p></li>
<li><p><strong>Specify the model</strong>, including functional form and variables</p></li>
<li><p><strong>Determine how to handle multi-purpose trips</strong> (i.e., trips with more than one goal)</p></li>
<li><p><strong>Design and conduct the visitor survey (get data from reservation system/ mobile data)</strong></p></li>
<li><p><strong>Measure trip costs</strong>, including travel expenses and time value</p></li>
<li><p><strong>Estimate the model</strong> using the collected data</p></li>
<li><p><strong>Calculate the access value</strong> by estimating <strong>consumer surplus</strong></p></li>
</ol>
<hr>
<section id="understanding-consumer-surplus" class="level3">
<h3 class="anchored" data-anchor-id="understanding-consumer-surplus">Understanding Consumer Surplus</h3>
<p>Consumer Surplus represents the area under the demand curve and above the actual price (travel cost) paid to access the park. This surplus reflects the net benefit or additional value visitors receive from their park experience beyond what they pay to get there. It is a commonly used metric for evaluating net recreational benefits.</p>
<hr>
</section>
</section>
</section>
<section id="single-site" class="level1">
<h1>Single Site</h1>
<p>Also known as a count model. We will work thru the following example</p>
<ol type="1">
<li><p><strong>Define the site</strong> :</p>
<p>We will look at a park that is potentially impacted from a road closer along highway 101. This park cod be closed because of sea level rise and position of the road.</p>
<p><img src="images/Screenshot 2025-10-05 at 8.27.56 PM.png" class="img-fluid"></p></li>
<li><p><strong>Identify the types of recreation</strong> and specify the relevant season.</p>
<p>It represents campers at a campground for a popular park on the Oregon Coast. This data set is specifically looking at the consumer surplus of camping at the park that would be loss if we donʻt do anything about the road.</p>
<p>Currently the only factors we know is that the road repairs will cost a lot and the repairs will impact access to the beach.</p></li>
<li><p><strong>Develop a sampling strategy</strong> for data collection</p>
<p>For this project we will use the data from the reservation system which gives us information on every camper over the last 4 years.</p></li>
<li><p><strong>Specify the model</strong>, including functional form and variables</p></li>
</ol>
<p>Load in the following data. You can download it <a href="https://github.com/loweas/ValuingNature/blob/main/park.csv">here</a>. But the following code should grab it as well.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>park <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://raw.githubusercontent.com/loweas/ValuingNature/refs/heads/main/park.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 33006 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): sitetype
dbl (8): zcta5ce10, month, year, trip, cost, income, temp_avg, mdays

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Here are the variables</p>
<p><code>sitetype</code> The type of site within the park</p>
<p><code>zcta5ce10</code> zip code</p>
<p><code>month</code> month of reservation</p>
<p><code>year</code> Year of reservation</p>
<p><code>trip</code> number of trips per zip code per month</p>
<p><code>cost</code> average cost per zip per month</p>
<p><code>income</code> medium income for each year at the zipcode level</p>
<p><code>temp_avg</code> average max temperature at the park in the given month</p>
<p><code>mdays</code> the average number of days stayed at the park per zip code.</p>
<p>Lets take a look at the structure</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(park<span class="sc">$</span>trip)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tc_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(park<span class="sc">$</span>cost)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tc_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This distribution is clearly a count variable (non negative observations). The pick is close to our near to zero which means that we should consider a count model when dealing with the data.</p>
<ol start="5" type="1">
<li><p><strong>Determine how to handle multi-purpose trips</strong> (i.e., trips with more than one goal) For this specific example we will first explore the a simple model and then how the number of days spent impacts the overall value of the trip.</p></li>
<li><p><strong>Design and conduct the visitor survey (get data from reservation system/ mobile data)</strong></p></li>
<li><p><strong>Measure trip costs</strong>, including travel expenses and time value</p>
<p>To get a distance measurement you can use online sources like <a href="https://project-osrm.org/">OSRM</a>. We have already calculated it for this example but I have provide a code snippet for consideration.</p></li>
</ol>
<section id="travel-distance-using-osrm" class="level3">
<h3 class="anchored" data-anchor-id="travel-distance-using-osrm">Travel Distance using OSRM</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Load Libraries ---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Install these packages if you haven't already:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("tidyverse", "httr"))</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Configuration ---</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Public OSRM Demo Server URL for the Routing Service</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>OSRM_URL <span class="ot">&lt;-</span> <span class="st">"http://router.project-osrm.org/route/v1/driving/"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>BATCH_DELAY <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Delay between API calls (in seconds)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Core OSRM API Call Function ---</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>get_osrm_route <span class="ot">&lt;-</span> <span class="cf">function</span>(start_lon, start_lat, end_lon, end_lat) {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Calls the OSRM API to get driving distance (meters) and duration (seconds).</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Note: OSRM requires coordinates in Lon,Lat order (Longitude first).</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  distance_m <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  duration_s <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for missing coordinates</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(start_lon) <span class="sc">||</span> <span class="fu">is.na</span>(start_lat) <span class="sc">||</span> <span class="fu">is.na</span>(end_lon) <span class="sc">||</span> <span class="fu">is.na</span>(end_lat)) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Distance_m =</span> distance_m, <span class="at">Duration_s =</span> duration_s))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct the request URL (LON,LAT;LON,LAT)</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">paste0</span>(start_lon, <span class="st">","</span>, start_lat, <span class="st">";"</span>, end_lon, <span class="st">","</span>, end_lat)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(OSRM_URL, coords, <span class="st">"?overview=false"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the API call</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="fu">timeout</span>(<span class="dv">5</span>))</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(response) <span class="co"># Check for HTTP errors (like 400)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for success and routes</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="sc">$</span>code <span class="sc">==</span> <span class="st">'Ok'</span> <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(data<span class="sc">$</span>routes) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      route <span class="ot">&lt;-</span> data<span class="sc">$</span>routes[[<span class="dv">1</span>]]</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      distance_m <span class="ot">&lt;-</span> route<span class="sc">$</span>distance</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      duration_s <span class="ot">&lt;-</span> route<span class="sc">$</span>duration</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle OSRM internal errors (like 'NoRoute')</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"  -&gt; OSRM API returned:"</span>, data<span class="sc">$</span>code, <span class="st">"for coordinates:"</span>, coords))</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Catch connection or status errors</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"  -&gt; OSRM Request Error:"</span>, e))</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results as a list</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Distance_m =</span> distance_m, <span class="at">Duration_s =</span> duration_s))</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Generic Main Function ---</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>calculate_routes_from_dataframe <span class="ot">&lt;-</span> <span class="cf">function</span>(df, start_lon_col, start_lat_col, end_lon_col, end_lat_col) {</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Calculates OSRM routes between specified coordinate columns in a dataframe.</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param df The input dataframe.</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param start_lon_col Name of the start longitude column (string).</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param start_lat_col Name of the start latitude column (string).</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param end_lon_col Name of the end longitude column (string).</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param end_lat_col Name of the end latitude column (string).</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @return The original dataframe with Distance_m and Duration_s columns appended.</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Starting generic OSRM calculations for "</span>, <span class="fu">nrow</span>(df), <span class="st">" entries...</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if all columns exist</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(start_lon_col, start_lat_col, end_lon_col, end_lat_col)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(df))) {</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Required column(s) not found:"</span>, <span class="fu">paste</span>(<span class="fu">setdiff</span>(required_cols, <span class="fu">names</span>(df)), <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Prepare data by selecting relevant columns, ensuring numeric, and removing NAs</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select only the relevant coordinate columns for the OSRM processing</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(required_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">original_index =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure all are numeric</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(required_cols), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter only rows with valid coordinates</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_any</span>(<span class="fu">all_of</span>(required_cols), is.na))</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>  total_processed <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_prepared)</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>  total_skipped <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df) <span class="sc">-</span> total_processed</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (total_processed <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid coordinate pairs found. Returning original dataframe.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Append NA columns to the original dataframe if no routes were processed</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Distance_m =</span> <span class="cn">NA_real_</span>, <span class="at">Duration_s =</span> <span class="cn">NA_real_</span>))</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"-&gt; Found "</span>, total_skipped, <span class="st">" entries with missing coordinates that will be skipped.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"-&gt; Processing "</span>, total_processed, <span class="st">" valid entries now.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Iterate and Call OSRM API</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectors to store results for the rows being processed</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  distance_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, total_processed)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  duration_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, total_processed)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_processed) {</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> df_prepared[i, ]</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">||</span> i <span class="sc">==</span> total_processed) {</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Processed row "</span>, i, <span class="st">"/"</span>, total_processed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">get_osrm_route</span>(</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>      row[[start_lon_col]], row[[start_lat_col]], </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>      row[[end_lon_col]], row[[end_lat_col]]</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    distance_vec[i] <span class="ot">&lt;-</span> results<span class="sc">$</span>Distance_m</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    duration_vec[i] <span class="ot">&lt;-</span> results<span class="sc">$</span>Duration_s</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(BATCH_DELAY)</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Merge results back to the original full dataframe</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>  df_results <span class="ot">&lt;-</span> df_prepared <span class="sc">%&gt;%</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(original_index) <span class="sc">%&gt;%</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">Distance_m =</span> distance_vec,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>      <span class="at">Duration_s =</span> duration_vec</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform a left join on the original row index</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>  df_final <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">original_index =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_results, <span class="at">by =</span> <span class="st">"original_index"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>original_index)</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">========================================================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Generic OSRM calculation complete. Returning augmented dataframe.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_final)</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Example Usage ---</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="co"># # 1. Create a dummy dataframe:</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="co"># # my_data &lt;- tibble(</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a><span class="co"># #   site_id = 1:3,</span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="co"># #   warehouse_lon = c(-157.8, -157.9, -158.0),</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="co"># #   warehouse_lat = c(21.3, 21.4, 21.5),</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="co"># #   customer_lon = c(-157.7, -157.8, NA), # NA added to test skipping</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a><span class="co"># #   customer_lat = c(21.4, 21.5, 21.6)</span></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="co"># # )</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a><span class="co"># # 2. Call the function, specifying your column names:</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="co"># # result_df &lt;- calculate_routes_from_dataframe(</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a><span class="co"># #   df = my_data,</span></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a><span class="co"># #   start_lon_col = "warehouse_lon",</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="co"># #   start_lat_col = "warehouse_lat",</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a><span class="co"># #   end_lon_col = "customer_lon",</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a><span class="co"># #   end_lat_col = "customer_lat"</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a><span class="co"># # )</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="co"># # The result will have the original columns plus Distance_m and Duration_s.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Thank for use the data has the travel distance already calculated for each zip code in the dataset.</p>
<ol start="8" type="1">
<li><strong>Estimate the model</strong> using the collected data</li>
</ol>
<p>We are using a zonal method to calculate the trips. Zonal travel cost means that for each location ID you are measuring the distance to park. The location ID is a zip code case.</p>
<p>A Poisson model (specifically <u>Poisson regression</u>) is a type of generalized linear model (GLM) designed to model count data. This is where the response variable represents counts of events (e.g., number of trips, visits, accidents).</p>
<p>This model accounts for the following:</p>
<ol type="1">
<li><p>Count outcomes (non-negative integers)</p>
<ul>
<li><p>Models outcomes like 0, 1, 2, 3…</p></li>
<li><p>Cannot produce negative predictions.</p></li>
</ul></li>
<li><p>The fact that the variance equals the mean</p>
<ul>
<li><p>In a Poisson distribution, the mean (μ) is equal to the variance (σ²).</p></li>
<li><p>This is a key assumption of the model:</p>
<p><span class="math display">\[ Var(Y)=E(Y) \]</span></p></li>
</ul></li>
<li><p>Skewed distribution</p>
<ul>
<li>Count data are often right-skewed (many small values, few large ones), which the Poisson model handles better than linear regression.</li>
</ul></li>
<li><p>Log-linear relationship between predictors and expected counts</p>
<ul>
<li><p>The model assumes a logarithmic link between the mean of the outcome and the predictors:</p>
<p><span class="math display">\[log⁡(μ)=β0+β1X1+β2X2+…e\]</span></p></li>
</ul></li>
<li><p><strong>Independent events</strong></p>
<ul>
<li>Each event (e.g., each person’s number of trips) is assumed to be <strong>independent</strong> of others.</li>
</ul></li>
</ol>
</section>
<section id="count-model" class="level2">
<h2 class="anchored" data-anchor-id="count-model">Count Model</h2>
<p>Simple cost and the decision of a trip</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">=</span><span class="fu">glm</span>(trip <span class="sc">~</span> cost, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> park, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = trip ~ cost, family = poisson(), data = park)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.255e+00  8.017e-03  156.59   &lt;2e-16 ***
cost        -2.716e-03  4.525e-05  -60.01   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 51093  on 31584  degrees of freedom
Residual deviance: 47034  on 31583  degrees of freedom
  (1421 observations deleted due to missingness)
AIC: 124676

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<ol start="9" type="1">
<li><strong>Calculate the access value</strong> by estimating <strong>consumer surplus</strong></li>
</ol>
<section id="simple-wtp" class="level3">
<h3 class="anchored" data-anchor-id="simple-wtp">Simple WTP</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>model1<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     cost 
-368.2565 </code></pre>
</div>
</div>
<p>The interpretation suggest that on average the consumer surplus for each person who camps at this park is on average $368.</p>
</section>
</section>
<section id="more-controls" class="level2">
<h2 class="anchored" data-anchor-id="more-controls">More Controls</h2>
<p>Multiple variable regression: Controlling for more factors in the model</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">glm</span>(trip <span class="sc">~</span> cost <span class="sc">+</span> income<span class="sc">+</span><span class="fu">factor</span>(year)<span class="sc">+</span>temp_avg<span class="sc">+</span>mdays<span class="sc">+</span><span class="fu">factor</span>(sitetype), </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> park, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = trip ~ cost + income + factor(year) + temp_avg + 
    mdays + factor(sitetype), family = poisson(), data = park)

Coefficients:
                                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                       -1.336e+00  7.652e-02 -17.459  &lt; 2e-16 ***
cost                              -3.308e-03  4.894e-05 -67.585  &lt; 2e-16 ***
income                             6.063e-06  1.888e-07  32.106  &lt; 2e-16 ***
factor(year)2019                  -3.635e-02  1.275e-02  -2.851 0.004356 ** 
factor(year)2020                   5.408e-02  1.502e-02   3.599 0.000319 ***
factor(year)2021                   5.592e-02  1.246e-02   4.489 7.17e-06 ***
factor(year)2022                   1.822e-02  1.292e-02   1.410 0.158455    
factor(year)2023                   5.927e-03  1.392e-02   0.426 0.670318    
temp_avg                           2.020e-02  5.505e-04  36.694  &lt; 2e-16 ***
mdays                              3.685e-02  2.914e-03  12.646  &lt; 2e-16 ***
factor(sitetype)ADA Standard Full  1.646e-02  9.708e-02   0.170 0.865350    
factor(sitetype)ADA TENT           1.324e-01  1.047e-01   1.265 0.205737    
factor(sitetype)GROUP TENT ONLY   -9.854e-02  8.400e-02  -1.173 0.240766    
factor(sitetype)HOST SITE          2.820e-01  1.917e-01   1.471 0.141265    
factor(sitetype)STANDARD           8.083e-01  6.718e-02  12.032  &lt; 2e-16 ***
factor(sitetype)STANDARD - FULL    7.389e-01  6.729e-02  10.982  &lt; 2e-16 ***
factor(sitetype)TENT SITE          1.146e+00  6.706e-02  17.090  &lt; 2e-16 ***
factor(sitetype)YURT               7.164e-01  6.754e-02  10.608  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 51093  on 31584  degrees of freedom
Residual deviance: 40221  on 31567  degrees of freedom
  (1421 observations deleted due to missingness)
AIC: 117894

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<section id="wtp" class="level3">
<h3 class="anchored" data-anchor-id="wtp">WTP</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>model2<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    cost 
-302.317 </code></pre>
</div>
</div>
<p>We can see with more controls our measurement reduces and is more conservative.</p>
<p>The consumer surplus is now around $302 per person.</p>
<p>From here you could take the sum of the season or year and calculate the WTP for this specific site. For example, a policy in which the park will impacted the park, funding for park, etc. This is helpful in estimating the total use value (consumer surplus) of one site.</p>
</section>
</section>
</section>
<section id="multi-site" class="level1">
<h1>Multi-Site</h1>
<p>A single site has a lot of caveats, however. You canʻt say much about what the impacts are to other parks. People may just trade-off to go to a different park and look at sites as a package.</p>
<p>In that cause we use a <strong>multi-site approach</strong> by estimating demand systems, comparing multiple sites, and valuing changes in site characteristics or policy scenarios.</p>
<p>Use <strong>multi-site models</strong> when:</p>
<ul>
<li><p>You want to evaluate relative site quality or rank sites.</p></li>
<li><p>You have data on multiple alternative sites and want to understand visitor choice behavior.</p></li>
<li><p>You’re interested in estimating marginal values of site attributes (e.g., distance, facilities, congestion).</p></li>
</ul>
<p>Common models used:</p>
<section id="random-utility-models-rums" class="level2">
<h2 class="anchored" data-anchor-id="random-utility-models-rums">Random Utility Models (RUMs)</h2>
</section>
</section>
<section id="nrem-691-fall-2025" class="level1">
<h1>NREM 691 Fall 2025</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Load Libraries ---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Configuration ---</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>API_KEY <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"RIDB_API_KEY"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>RIDB_BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://ridb.recreation.gov/api/v1/"</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Core API Function ---</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>query_ridb <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">endpoint =</span> <span class="st">"facilities"</span>, <span class="at">search_term =</span> <span class="cn">NULL</span>, <span class="at">api_key =</span> API_KEY, <span class="at">limit =</span> <span class="dv">50</span>) {</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(RIDB_BASE_URL, endpoint)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  query_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> api_key,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">limit =</span> limit</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(search_term)) {</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    query_params<span class="sc">$</span>query <span class="ot">&lt;-</span> search_term</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Fetching data from: "</span>, url, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query_params)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(response)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    data_list <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(content, <span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"RECDATA"</span> <span class="sc">%in%</span> <span class="fu">names</span>(data_list) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(data_list<span class="sc">$</span>RECDATA)) {</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Successfully retrieved "</span>, <span class="fu">nrow</span>(data_list<span class="sc">$</span>RECDATA), <span class="st">" records.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(data_list<span class="sc">$</span>RECDATA)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Warning: API response structure unexpected. No 'RECDATA' found.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"An error occurred during the API call: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Example Usage ---</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>facilities_df <span class="ot">&lt;-</span> <span class="fu">query_ridb</span>(</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">endpoint =</span> <span class="st">"facilities"</span>,</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_term =</span> <span class="st">"Yosemite National Park camping"</span>,</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">100</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Fetching data from: https://ridb.recreation.gov/api/v1/facilities
Successfully retrieved 36 records.</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Inspect Results ---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(facilities_df)) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Structure of the Results ---</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(facilities_df))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Structure of the Results ---
  ACTIVITY CAMPSITE EVENT Enabled FACILITYADDRESS FacilityAccessibilityText
1     NULL     NULL  NULL    TRUE            NULL                          
2     NULL     NULL  NULL    TRUE            NULL                          
3     NULL     NULL  NULL    TRUE            NULL                          
4     NULL     NULL  NULL    TRUE            NULL                          
5     NULL     NULL  NULL    TRUE            NULL                          
6     NULL     NULL  NULL    TRUE            NULL                          
  FacilityAdaAccess
1                 N
2                 N
3                 N
4                 N
5                 N
6                 N
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           FacilityDescription
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        &lt;h2&gt;Overview&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;Tuolumne Meadows Campground is closed for the 2025 season.&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Tuolumne Meadows Campground is reopening after three years due to a complete overhaul and rehabilitation of the campsites. Please be mindful of young plants and shrubs by keeping all wheels on parking pads and camping equipment within established campsites. Thank you and welcome back!&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;Tuolumne Meadows Campground is located in breathtaking Yosemite National Park in Central California's rugged Sierra Nevada Mountain Range at an elevation of 8,600 feet. The site is situated along the scenic Tioga Road just five miles from the Tioga Pass Entrance Station. Within Yosemite, visitors can gaze upon waterfalls, sheer granite cliffs, deep valleys, grand meadows, ancient giant sequoias, vast wilderness areas, and so much more.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Reservation Tips! &lt;/strong&gt;Campsites in Yosemite are extremely popular and typically sell out in minutes. Login to your account or create a new account before the 7:00 a.m. (PST) release time. You may only add reservations to your cart and proceed with your reservation if you are logged into your account. The recreation.gov call center does NOT have access to additional sites or additional information beyond what is published on recreation.gov.&lt;/p&gt;&lt;h2&gt;Recreation&lt;/h2&gt;\nPopular activities in the area include hiking, rock climbing, backpacking and fishing. The 4.8-mile roundtrip trail to Elizabeth Lake begins in the campground and climbs to a glacier-carved lake at the base of Unicorn Peak. &lt;br/&gt;&lt;br/&gt;\nOther trails in Tuolumne Meadows include Soda Springs and Parsons Lodge, Lyell Canyon via the John Muir Trail, Cathedral Lakes, Mono Pass, and Glen Aulin. Nearby Tenaya Lake is a magnificent spot for picnicking, swimming and canoeing.&lt;h2&gt;Facilities&lt;/h2&gt;\n&lt;p&gt;This large, popular campground contains family, horse and group camp sites with picnic tables, fire rings, and a food storage lockers. Flush toilets, drinking water, and an amphitheater are provided. Tuolumne Meadows Visitor Center is within walking distance, as is a general store.&lt;/p&gt;&lt;h2&gt;Natural Features&lt;/h2&gt;\nTuolumne Meadows embodies the high-country of the Sierra Nevada, with its broad sub-alpine meadows and granite domes and peaks. The gentle Tuolumne River, Lyell For, and Dana Fork flow through the vast, colorful meadows bursting with seasonal wildflowers. The meadows are surrounded by stands of Western White pine, Mountain hemlock, and Lodgepole pine.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nYosemite Valley, an awe-inspiring landscape containing many of the famous features for which Yosemite National Park is known, is 55 miles and two hours from Tuolumne Meadows. Hiking trails and bike paths are abundant in the valley. Rafting the Merced River is a fun way to cool down on a summer day when water levels are sufficient. Yosemite Valley also offers numerous guided bus tours, educational programs, museums, ranger-led activities, and an art center with workshops.&lt;br/&gt;&lt;br/&gt;\nGlacier Point is an hour from Yosemite Valley, with sweeping views of both Yosemite and Little Yosemite Valley, Half Dome, Vernal and Nevada Falls, and Clouds Rest, among other notable landmarks. &lt;br/&gt;&lt;br/&gt;\nA visit to Wawona and the Pioneer Yosemite History Center is like stepping back in time.&lt;br/&gt;&lt;br/&gt;&lt;h2&gt;Charges &amp; Cancellations&lt;/h2&gt;\n\nCancellation of individual or equestrian site reservations will be charged a $10 service fee. If the cancellation is within 48 hours of the arrival date, the first night's fee will also be charged.\n\nCancellation of a group site reservation will incur a $10.00 service fee plus the first night’s use fee when the reservation is cancelled within 14 days of the scheduled arrival date. \n\nCancellations for a single night’s use will not be assessed a service fee. \n\nNo-shows for any type of reservation will be charged a $20 service fee and the first night's fee.
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             &lt;h2&gt;Overview&lt;/h2&gt;\nTrailhead Group Campground is located in the eastern high Sierra Nevada Mountains of California at just over 10,000 feet in elevation. Also known as Saddlebag Lake Group Campground, the facility is adjacent to the scenic lake and provides a quiet mountain getaway for groups of up to 25 people. It is within a two-hour drive of Yosemite National Park and Mono Lake, and lies next to the Hoover Wilderness.&lt;h2&gt;Recreation&lt;/h2&gt;\nCampers might like to relax and unwind by picnicking in the forested camping area or around the lake. The eastern Sierras are well-known for trout fishing, and Saddlebag Lake is no exception. Anglers can access a boat ramp nearby or try their luck for rainbow, brook and brown trout from shore. The lake has a 15 mph speed limit.\n&lt;br/&gt;&lt;br/&gt;\nThe majestic scenery and challenging trails are a big draw for hikers. Close by, campers can access the Twenty Lakes Basin Trail, which leads into the Hoover Wilderness.&lt;h2&gt;Facilities&lt;/h2&gt;\nOne group area is available for tents only. Flush toilets and picnic tables are provided. The group campground is next to the main Saddlebag Lake Campground, which is a small facility with individual sites available on a first-come, first-served basis. Drinking water is available at the main campground, but not directly in the group camping area.\n&lt;br/&gt;&lt;br/&gt;\nThe lake's resort offers a restaurant, camping and fishing supplies and boat rentals.&lt;h2&gt;Natural Features&lt;/h2&gt;\nThe campground is situated in a high elevation pine forest next to scenic 600-acre Saddlebag Lake, though not directly on the lake shore. Many species of wildlife call the mountains home, such as black bear, mountain lions, mule deer, pine marten, pika and numerous fish and birds.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nThe Mono Lake area and Yosemite National Park are great day trips, and hikers can access the spectacular scenery of the Hoover Wilderness via nearby trails.\n&lt;br/&gt;&lt;br/&gt;\n&lt;a href="http://www.recreation.gov/recAreaDetails.do?contractCode=NRSO&amp;recAreaId=13061&amp;agencyCode=131" rel="nofollow"&gt;Hoover Wilderness&lt;/a&gt;\n&lt;br/&gt;&lt;br/&gt;\n&lt;a href="http://www.nps.gov/yose/index.htm" rel="nofollow"&gt;Yosemite National Park&lt;/a&gt;&lt;h2&gt;Charges &amp; Cancellations&lt;/h2&gt;\n&lt;p&gt;Once your reservation start date has begun, neither the Recreation.gov Contact Center nor the campground manager will be able to modify your reservation.&lt;/p&gt;\n
3 &lt;h2&gt;Overview&lt;/h2&gt;\nThe outstanding lake and mountain views at Oh Ridge Campground make it a favorite spot for both families and anglers. It sits in the eastern Sierra Nevada Mountains in close proximity to the Ansel Adams Wilderness, Yosemite National Park and Mono Lake. The nearby town of June Lake offers the convenience of shopping and dining, while the surrounding land and lakes provide ample outdoor recreation opportunities.&lt;h2&gt;Recreation&lt;/h2&gt;\nOh Ridge campers have no problem staying busy and enjoying the outdoors. Within the facility, they can swim in the lake's clear waters, fish for rainbow and Alpers trout, go canoeing and boating or walk to the Oh Ridge viewpoint, after which the campground was named.\n&lt;br/&gt;&lt;br/&gt;\nNumerous trails lie minutes away, an obvious draw for hikers, mountain bikers and off-road vehicle enthusiasts. The Fern Lake Trail leads into the scenic Ansel Adams Wilderness. Skiing is a major winter pastime in the area.\n&lt;br/&gt;&lt;br/&gt;\nA scenic drive along the June Lake Loop results in expansive views of rugged mountain peaks and several lakes.&lt;h2&gt;Facilities&lt;/h2&gt;\nThis is a large facility with campsites organized among several loops named after area animals. The campground is equipped with drinking water and flush toilets, and sites have picnic tables, grills and bear-proof lockers for food storage.\n&lt;br/&gt;&lt;br/&gt;\nThe nearby resort offers showers and basic groceries and camping supplies.&lt;h2&gt;Natural Features&lt;/h2&gt;\nCampsites are located in a mostly open area above the shoreline of beautiful June Lake. Save for some scattered pine and aspen trees, the campground has little shade. Nearly every point in the facility has a view of the surrounding 11,000-12,000' peaks. The campground's elevation is 7,600 feet.\n&lt;br/&gt;&lt;br/&gt;\nMany species of wildlife call the mountains home, such as black bear, mountain lions, mule deer, pine marten, pika and numerous fish and birds.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nMono Lake and its many activities are minutes away. Hikers can access the scenic Ansel Adams Wilderness via nearby trails, and Yosemite National Park is a great day trip.\n&lt;br/&gt;&lt;br/&gt;\n&lt;a href="http://www.recreation.gov/recAreaDetails.do?contractCode=NRSO&amp;recAreaId=12842&amp;agencyCode=128" rel="nofollow"&gt;Ansel Adams Wilderness&lt;/a&gt;\n&lt;br/&gt;&lt;br/&gt;\n&lt;a href="http://www.nps.gov/yose/index.htm" rel="nofollow"&gt;Yosemite National Park&lt;/a&gt;&lt;h2&gt;Charges &amp; Cancellations&lt;/h2&gt;\n\n&lt;p&gt;&lt;strong&gt;Rules &amp; Reservation Policies&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;As you make travel plans that include reservations on Recreation.gov, there are standard policies that apply to most locations of which you should be aware. Do keep in mind, however, that there are many exceptions, so it is best to review reservation information listed on individual facility pages for those policies and procedures that pertain to your specific locations.&lt;/p&gt;\n\n&lt;p&gt;Any location or activity requiring a permit or lottery will have unique requirements and policies. Please check individual facility pages for pertinent information for those sites.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Booking Window&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;For most locations, you can reserve six months in advance of your stay for individual sites and 12 months in advance for group sites. There are some exceptions, so it is best to check with each facility.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Change and Cancellation Policies and Fees&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Overnight and Day Use Facilities: To ensure fairness, reservation arrival or departure dates may not be changed beyond the booking window until 18 days after booking the reservation.&lt;/p&gt;\n\n&lt;p&gt;Camping / Day Use: A $10.00 service fee will apply if you change or cancel your reservation (including campsites, cabins, lookouts, group facilities, etc.). The $10.00 service fee will be deducted from the refund amount.&lt;/p&gt;\n&lt;p&gt;You can cancel or change reservations through Recreation.gov or by calling 1-877-444-6777.&lt;/p&gt;\n&lt;p&gt;Tours &amp; Tickets: You may request changes to tour dates at no cost before the arrival date. If you cancel before your tour date, you may be eligible for a refund. Cancellation fees apply. Please check the tour facility description details page for cancellation policies.&lt;/p&gt;\n\n&lt;p&gt;Permits: Varies by location. Please check the permit details for the permit location.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Late Cancellations&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Overnight and Day Use Facilities: Late cancellations are those cancelled between 12:01 a.m. (Eastern) on the day before arrival and check out time on the day after arrival.&lt;/p&gt;\n&lt;p&gt;Individual Campsites: If a customer cancels a reservation the day before or on the day of arrival they will be charged a $10.00 service fee and will also forfeit the first night's use fee (not to exceed the total paid for the original reservation). Cancellations for a single night's reservation will forfeit the entire use fee but no cancellation fee will apply.&lt;/p&gt;\n&lt;p&gt;Cabins / Lookouts: Customers will be charged a $10.00 cancellation fee and forfeit the first night's use fee if a cabin or lookout reservation is cancelled within 14 days of the scheduled arrival date. Cancellations for a single night's use will not be assessed a service fee.&lt;/p&gt;\n&lt;p&gt;Group Facility: If a customer cancels a group overnight facility reservation within 14 days of the scheduled arrival date they will be charged the $10.00 service fee and forfeit the first night's use fee. Cancellations for a single night's use will not be assessed a service fee.&lt;/p&gt;\n&lt;p&gt;Group Day Use Area: If a customer cancels a group day use facility reservation within 14 days of the scheduled arrival date, they will forfeit the total day use fee with no service fee charge.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;No-Shows&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Camping / Day Use: A camping no-show customer is one who does not arrive at a campground and does not cancel the reservation by check-out time on the day after the scheduled arrival date. Reserved campsites and group overnight facilities will be held until check-out time on the day following your scheduled arrival. Group day-use facilities will be held until check-in time on your scheduled arrival date.&lt;/p&gt;\n\n&lt;p&gt;If a customer does not arrive at the campground or group facility by check-out time the day after arrival or does not cancel the reservation by the times listed under "Late Cancellations" above, the customer may be assessed a $20.00 service fee and forfeit use fees.&lt;/p&gt;\n\n&lt;p&gt;Tours: A tour or ticket no-show is one who does not cancel a ticket before arrival and does not arrive for the tour. Tour no-shows are not entitled to a refund.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Refunds&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Customers must request refunds no later than 14 days after the scheduled departure date. Recreation.gov will not grant refund requests after 14 days of departure.&lt;/p&gt;\n\n&lt;p&gt;Reservation Fee: For some facilities, tours or permits an additional reservation fee is charged. For some overnight and day-use facilities, an additional non-refundable reservation fee may apply. The non-refundable reservation fee for tours and tickets is $1.00. The non-refundable reservation fee for permits varies by location.&lt;/p&gt;\n&lt;p&gt;Refunds for Bankcard Purchases: Refunds for bank card payments will be issued as a credit to the original bank card.&lt;/p&gt;\n&lt;p&gt;Refunds for Check or Cash Purchases: Refunds for Recreation.gov payments made by check or money order, and cash payments at selected campgrounds will be issued a check refund. A refund will be processed within 30 days of receipt and approval. Please Note: Refund requests made during or after departure can only be processed when approved by the facility management staff based upon local policy.&lt;/p&gt;\n&lt;p&gt;Refunds for Emergency Closures: In the event of an emergency closure, the Recreation.gov team will attempt to notify users and offer alternate dates (as appropriate). If this is not possible, reservations will be cancelled and all fees paid will be refunded. Reservation fees for free tickets are non-refundable in the event of an emergency closure.&lt;/p&gt;\n&lt;p&gt;Recreation.gov Billing Information&lt;/p&gt;\n&lt;p&gt;Reservation transaction will appear on customer's credit card statements as "Recreation.gov 877-444-6777."&lt;/p&gt;\n\n&lt;p&gt;Changes to Policies and Procedures&lt;/p&gt;\n&lt;p&gt;Recreation.gov reserves the right, when necessary, to modify reservation policies. These policies were last updated July&nbsp;&lt;/p&gt;\n
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   &lt;h2&gt;Overview&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;Crane Valley will be closed the entire 2019 - 2028 camping season due to a massive hazard tree removal &lt;/strong&gt;&lt;br&gt;&lt;br&gt;Crane Valley Group Campground is located adjacent to Bass Lake and can accommodate up to 7 groups with tents and RVs. The facility is shaded by a dense forest of oak, cedar and pine trees, and although none of the sites offer direct views of the lake, the campground offers convenient access to the many recreational activities and attractions in the area.&lt;/p&gt;\n&lt;h2&gt;Recreation&lt;/h2&gt;\nActivities on Bass Lake include motorized and non-motorized boating, fishing, swimming, hiking, sailing and water skiing. California Land Management sponsors \na variety of interpretive programs throughout the summer at several locations in the Bass Lake area. \n&lt;h2&gt;Facilities&lt;/h2&gt;\nThis group campground has 7 sites that can accommodate between 12 to 30 people each. Each site has grills, fire rings and tables. Portable toilets are provided, but campers must bring drinking water. \n&lt;h2&gt;Natural Features&lt;/h2&gt;\nThe Sierra National Forest, located on the western slope of the central Sierra Nevada, is known for its spectacular mountain scenery and abundant natural \nresources.&lt;br/&gt;&lt;br/&gt;\nThe terrain includes rolling, oak-covered foothills, heavily forested middle elevation slopes and the starkly beautiful alpine landscape of the High Sierra.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nYosemite National Park is under an hour away and makes an ideal day trip from Crane Valley Campground. 
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          &lt;h2&gt;Overview&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;Texas Flats Campground remains closed due to hazard trees.&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Texas Flats Campground is a horse-friendly group camp situated on the banks of McGilvery Creek. It is split into 4 sections named manzanita, red fir, white fir and cedar.&lt;/p&gt;\n&lt;h2&gt;Recreation&lt;/h2&gt;\nNearby logging and forest roads can be used as equestrian trails. The Shadow of the Giants, a popular 1-mile hike through a grove of giant sequoias, is just a short drive northwest of the campground.&lt;h2&gt;Facilities&lt;/h2&gt;\nEach campsite can accommodate between 20-30 people and has picnic tables and campfire rings. Vault toilets are provided, but campers need to bring drinking water. This campground does not have facilities or corrals for horses.&lt;h2&gt;Natural Features&lt;/h2&gt;\nThe Sierra National Forest, located on the western slope of the central Sierra Nevada, is known for its spectacular mountain scenery and abundant natural resources. The terrain includes rolling, oak-covered foothills, heavily forested middle elevation slopes and the starkly beautiful alpine landscape of the High Sierra.\n&lt;br/&gt;&lt;br/&gt;\nTexas Flat Campground is located in the Highway 41 Corridor of the Bass Lake Ranger District. This area is known for the Nelder Grove of giant sequoias.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nYosemite National Park is a popular day trip. Visitors can also take a ride on the historic logging train at Yosemite Mountain Sugar Pine Railroad.\n&lt;br/&gt;&lt;br/&gt;\nThe Sierra Vista Scenic Byway (Sky Ranch Road), an 83-mile drive past some of the highlights of Sierra National Forest, runs nearby.
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         &lt;h2&gt;Overview&lt;/h2&gt;\nChilkoot is named for the creek that runs by the campground. The facility is shaded by a grove of Ponderosa pine, fir and cedar, and offers ample space for tent or RV camping. &lt;br/&gt;&lt;br/&gt;  \nThis campground is located at an elevation of approximately 4,600 feet, providing a comfortable camping experience during the hottest days of summer.&lt;h2&gt;Recreation&lt;/h2&gt;\nA popular recreation and resort area is a few miles away at Bass Lake. Activities here include motorized and non-motorized boating, fishing, swimming, hiking, sailing and water skiing.&lt;br/&gt;&lt;br/&gt; \n\nAnglers can fish in Chilkoot Creek for channel catfish, sucker and brown trout. Other nearby activities include hiking the Buena Vista trail and paddling on Willow Creek.&lt;h2&gt;Facilities&lt;/h2&gt;\nThis rustic campground provides a host and vault toilets but no water. Each unit has a gravel parking spur, picnic table and fire ring. Some sites are located on slopes and are not suitable for tents, while other sites are tent only.&lt;h2&gt;Natural Features&lt;/h2&gt;\nThe Sierra National Forest, located on the western slope of the central Sierra Nevada, is known for its spectacular mountain scenery and abundant natural \nresources.&lt;br/&gt;&lt;br/&gt;\n\nThe terrain includes rolling, oak-covered foothills, heavily forested middle elevation slopes and the starkly beautiful alpine landscape of the High Sierra.\n&lt;h2&gt;Nearby Attractions&lt;/h2&gt;\nYosemite National Park can be reached in under an hour from Chilkoot Campground. The South Fork of the Merced River is also nearby, which is popular for whitewater rafting.&lt;h2&gt;Charges &amp; Cancellations&lt;/h2&gt;\n&lt;p&gt;Once your reservation start date has begun, neither the Recreation.gov Contact Center nor the campground manager will be able to modify your reservation.&lt;/p&gt;\n
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    FacilityDirections
1 &lt;p&gt;Take Highway 41 north from Fresno, Highway 140 east from Merced, Highway 120 east from Manteca or west from Lee Vining (State Route 395) into Yosemite National Park. Tuolumne Meadows Campground is located 5 miles from the Tioga Pass Entrance station (Hwy 120 from the east), and is 55 miles (2 hours) from Yosemite Valley.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;OVERFLOW PARKING: &lt;/strong&gt;Many sites in Tuolumne Meadows Campground can only accommodate one single vehicle. There is overflow parking available at the Parson's Lodge Trailhead Parking as well as the parking lot directly West of the Tuolumne Meadows Grill and Store (the old gas station lot). Limited parking is also available on the side of the Soda Springs Road past Lembert Dome Trailhead parking. Lembert Dome Parking lot is &lt;em&gt;NOT&lt;/em&gt; available for overnight parking. &lt;/p&gt;
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Take U.S. Highway 395 in California to its junction with State Highway 120 west. Take 120 west 10 miles toward Tioga Pass. Turn right on Forest Road 1N04 to Saddlebag Lake. Proceed up 1N04 for 2.4 miles. Take the first right just past the open gate on the road. The campground is on the right, just past the restroom.
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Oh Ridge Campground is 350 miles north of Los Angeles and 150 miles south of Reno, Nevada. Take U.S. Highway 395 to its southern junction with Highway 158. Take 158 for 1 mile. Turn right on North Shore Drive. Go approximately 1 mile and turn left on Pine Cliff Road. Go 0.5 mile to campground entrance.
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    From Fresno, California, take Highway 41 north through Oakhurst.  Turn\nright on Forest Road 222, towards Bass Lake. Keep right for 3.5 miles to\nthe campground.
5                                                                                                                                                                                                                                                                                                                                                                                                     Take Highway 41 north through Oakhurst past Rd. 222 (aka Bass Lake turn off), to Road 632 (aka Sky Ranch Road). &lt;br/&gt;\nTurn right, travel 7 miles, and turn right on FS6S40 towards Soquel Campground. &lt;br/&gt;\nTravel for 1 mile, turn left on 6S08, cross the bridge and continue left through Greys Mt. Campground. &lt;br/&gt;\nTravel for 1 mile, turn left on 6S38, and continue for 2 miles to Texas Flat Campground. (Distances approximate). \n
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Directions from Fresno: Take Highway 41 through Oakhurst, California.  Turn east on Forest Road\n222 (Bass Lake turnoff) and continue on for 7 miles. Turn left onto Beashore Road, follow Beashore Road for 4 miles to the Chilkoot Campground.
         FacilityEmail FacilityID FacilityLatitude FacilityLongitude
1                          232448         37.87111         -119.3600
2 clm@clm-services.com     232422         37.96433         -119.2723
3 clm@clm-services.com     232269         37.79750         -119.0747
4 clm@clm-services.com     232909         37.33328         -119.5861
5 clm@clm-services.com     232879         37.42545         -119.5445
6 clm@clm-services.com     232882         37.36749         -119.5374
  FacilityMapURL                        FacilityName
1                        Tuolumne Meadows Campground
2                Saddlebag Lake Trailhead Group Camp
3                                           OH RIDGE
4                                       CRANE VALLEY
5                                        TEXAS FLATS
6                                           CHILKOOT
                 FacilityPhone FacilityReservationURL FacilityTypeDescription
1 209-372-4025 OR 209-372-8502                                     Campground
2                                                                  Campground
3                 760-648-7744                                     Campground
4                 559-642-3212                                     Campground
5                 559-642-3212                                     Campground
6                                                                  Campground
  FacilityUseFeeDescription
1                          
2                          
3                          
4                          
5                          
6                          
                                                                       Keywords
1                                                        Yosemite National Park
2                                   TRAG,SADDLEBAG LAKE GROUP CAMP,INYO NF - FS
3                                                             OHRI,INYO NF - FS
4                                     CRVA,BASS LAKE OAKHURST AR,SIERRA NF - FS
5 TEXA,MANZANITA GROUP,WHITE FIR GROUP,RED FIR GROUP,CEDAR GROUP,SIERRA NF - FS
6                                                           CHKO,SIERRA NF - FS
  LINK LastUpdatedDate LegacyFacilityID
1 NULL      2025-10-24            70926
2 NULL      2025-07-11            70832
3 NULL      2025-08-04            70565
4 NULL      2025-07-11            71719
5 NULL      2025-07-11            71667
6 NULL      2025-07-11            71670
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    MEDIA
1 NPS/EBissmeyer, NPS/EBissmeyer, NPS/EBissmeyer, NPS/EBissmeyer, NPS, NPS, NPS, Share the Experience, Sharon Soberon, NPS, Entrance to Backpackers Camp, tent in a campsite, Clouds Rest sunset, Tuolumne campsite 24H, campground map, Tuolumne Campground Reservation Office, Tuolumne River, Lembert Dome in the background, Yosemite National Park, Tuolumne Meadows, View of the Tuolumne River and Lembert Dome, , , , , , , , , , 232448, 232448, 232448, 232448, 232448, 232448, 232448, 232448, 232448, 2a48a566-4eb8-4565-933e-7094a2721e43, 4d8c3fe0-5edb-4cef-ade7-d50ddca00c41, f2227189-2916-4f8e-937d-19e36394b524, 2fa488e7-ebbd-48bc-9689-1c53b4dc1e77, 61468c91-f285-4afe-9855-cd98e7784509, 2572433, 2572393, 07fc0b0a-330b-4a66-acaf-edca98b366e4, 2572316, Facility, Facility, Facility, Facility, Facility, Facility, Facility, Facility, Facility, 525, 525, 908, 525, 875, 526, 526, 340, 526, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, Image, Image, Image, Image, Image, Image, Image, Image, Image, , , , , , , , , , Entrance to Backpackers Camp., tent in a campsite, Clouds Rest sunset, Tuolumne campsite 24H, campground map, TUOLUMNE MEADOWS Campground Office, TUOLUMNE MEADOWS Tuolumne River, Yosemite National Park, TUOLUMNE MEADOWS Lembert Dome, https://cdn.recreation.gov/public/2025/08/05/05/53/232448_2311f358-b58b-40a6-a5c9-ee83cc32fff4_700.webp, https://cdn.recreation.gov/public/2025/08/05/05/50/232448_422d8aa3-1071-4e8b-984c-96c5ffca38a9_700.webp, https://cdn.recreation.gov/public/2025/01/14/05/19/232448_ed779ec4-aa75-4d6b-82da-79830a594bb1_1440.webp, https://cdn.recreation.gov/public/2025/01/14/05/24/232448_9b48004d-b42a-4de5-9a35-5dc433e5ef72_700.webp, https://cdn.recreation.gov/public/2025/08/05/05/44/232448_32f59bb2-d32c-4776-b777-21cc56b451c2_1440.webp, https://cdn.recreation.gov/public/images/65928_700.webp, https://cdn.recreation.gov/public/images/65886_700.webp, https://cdn.recreation.gov/public/2018/09/13/17/05/232448_93e7d5fd-15b8-4748-a193-b18d3bbf5d23_1440.webp, https://cdn.recreation.gov/public/images/65805_700.webp, 700, 700, 1440, 700, 1440, 700, 700, 1440, 700
2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Staff, Staff, , Trailhead Group Area, Photo of group area , , , , , 232422, 232422, 232422, debdb524-ea62-44a0-b5c5-401791ec318a, 6b4a27c1-faf0-4fd2-9416-c6aa7bf881a1, 2572243, Facility, Facility, Facility, 525, 810, 957, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, Image, Image, Image, , , , Trailhead Group Campground, Trailhead Group , TRAILHEAD GROUP, https://cdn.recreation.gov/public/2023/03/01/21/17/232422_5dc5cf56-b39b-40cb-90c8-26737923bf51_700.webp, https://cdn.recreation.gov/public/2023/03/01/21/15/232422_d71a79b0-72df-4a13-96ed-75787cd50536_1440.webp, https://cdn.recreation.gov/public/images/65746_1440.webp, 700, 1440, 1440
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 CLM, CLM, CLM, , CLM, CLM, CLM, Oh Ridge Campground, Oh Ridge Campground, Oh Ridge Campground, , Oh Ridge Campground, Oh Ridge Campground, Oh Ridge Campground, , , , , , , , 232269, 232269, 232269, 232269, 232269, 232269, 232269, 2571469, 1f8e3d7b-7f5b-4026-8547-b418d272000f, e37d6768-3f74-4a0f-9bda-cfe38686e5bb, 2571353, 2571531, 2571498, 2571496, Facility, Facility, Facility, Facility, Facility, Facility, Facility, 957, 340, 525, 973, 957, 957, 822, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, Image, Image, Image, Image, Image, Image, Image, , , , , , , , Oh Ridge Campground, Oh Ridge Campground, Oh Ridge Campground, OH RIDGE, Oh Ridge Campground, Oh Ridge Campground, Oh Ridge Campground, https://cdn.recreation.gov/public/images/64991_1440.webp, https://cdn.recreation.gov/public/2019/02/11/23/45/232269_b0917550-b166-4dac-9b79-72a2035e8e0c_1440.webp, https://cdn.recreation.gov/public/2019/02/11/23/52/232269_ebc10959-c028-4d13-b2e4-5deb6d22c0d4_700.webp, https://cdn.recreation.gov/public/2019/02/11/23/53/232269_9a4b8626-7ecc-4899-a1c3-f75111887ec4_1440.webp, https://cdn.recreation.gov/public/images/65064_1440.webp, https://cdn.recreation.gov/public/images/65024_1440.webp, https://cdn.recreation.gov/public/images/65022_1440.webp, 1440, 1440, 700, 1440, 1440, 1440, 1440
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   , USFS, USFS, , , , , , Crane Valley Campground, Crane Valley Campground, , , , , , , , , , , , 232909, 232909, 232909, 232909, 232909, 232909, 232909, 2574065, 4a9cdb75-14d0-475e-ba6b-657406b0c9c2, 9b432399-6e19-4d25-b6ad-aecea9455081, 2574069, 2574067, 2574064, 2574066, Facility, Facility, Facility, Facility, Facility, Facility, Facility, 944, 811, 526, 1065, 957, 955, 951, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, Image, Image, Image, Image, Image, Image, Image, , , , , , , , CRANE VALLEY, A picnic table in a forest grove, Picnic tables and fire rings at campsites in a forest grove, CRANE VALLEY, CRANE VALLEY, CRANE VALLEY, CRANE VALLEY, https://cdn.recreation.gov/public/images/75236_1440.webp, https://cdn.recreation.gov/public/2024/01/12/15/51/232909_1ae8a119-495c-4f9e-8e59-106c30cec4d6_1440.webp, https://cdn.recreation.gov/public/2024/01/12/15/52/232909_fd1d6d71-db69-4dfa-bf53-26a2eeef13ee_700.webp, https://cdn.recreation.gov/public/images/75240_700.webp, https://cdn.recreation.gov/public/images/75238_1440.webp, https://cdn.recreation.gov/public/images/75235_1440.webp, https://cdn.recreation.gov/public/images/75237_1440.webp, 1440, 1440, 700, 700, 1440, 1440, 1440
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      USFS, USFS, , , , , , Texas Flats Group Camp, Texas Flats Campground, , , , , , , , , , , , , 232879, 232879, 232879, 232879, 232879, 232879, 232879, f4c3d1be-3790-4ecf-af71-d84bf9ad0f12, 4ec779c9-58bb-4b1a-bb21-350a19fbedab, 2573822, 2573819, 2573821, 2573818, 2573672, Facility, Facility, Facility, Facility, Facility, Facility, Facility, 526, 811, 957, 957, 957, 957, 957, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, Image, Image, Image, Image, Image, Image, Image, , , , , , , , A brown and yellow Forest Service sign for Texas Flats Group Camp, Picnic tables and logs under a grove of trees, TEXAS FLATS, TEXAS FLATS, TEXAS FLATS, TEXAS FLATS, TEXAS FLATS, https://cdn.recreation.gov/public/2024/01/24/15/44/232879_6d87624a-fc35-44db-a4c8-ae674fc41dd0_700.webp, https://cdn.recreation.gov/public/2024/01/24/15/43/232879_ab08793d-4e12-49d9-a1f8-e1404c3f64ab_1440.webp, https://cdn.recreation.gov/public/images/75204_1440.webp, https://cdn.recreation.gov/public/images/75201_1440.webp, https://cdn.recreation.gov/public/images/75203_1440.webp, https://cdn.recreation.gov/public/images/75200_1440.webp, https://cdn.recreation.gov/public/images/66946_1440.webp, 700, 1440, 1440, 1440, 1440, 1440, 1440
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    USFS, USFS, Entry Sign, Entry Sign, , , 232882, 232882, c6a51777-e2b3-422b-a4e5-a0d3c6849157, d0bba74b-89f5-42ae-915c-5d5dbd2330d9, Facility, Facility, 810, 525, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, Image, Image, , , A brown and yellow Forest Sign for Chilkoot Campground on the Sierra National Forest, A brown and yellow Forest Sign for Chilkoot Campground on the Sierra National Forest, https://cdn.recreation.gov/public/2024/01/12/15/41/232882_d0e4990b-ad8a-47b5-ab18-4738ca1b47a3_1440.webp, https://cdn.recreation.gov/public/2024/01/12/15/39/232882_19e8e4de-712e-4a64-a0a3-89399b11d507_700.webp, 1440, 700
  ORGANIZATION OrgFacilityID PERMITENTRANCE ParentOrgID ParentRecAreaID RECAREA
1         NULL      AN370926           NULL         128            2991    NULL
2         NULL      AN370832           NULL         131            1064    NULL
3         NULL      AN370565           NULL         131            1064    NULL
4         NULL      AN371719           NULL         131            1074    NULL
5         NULL      AN371667           NULL         131            1074    NULL
6         NULL      AN371670           NULL         131            1074    NULL
  Reservable StayLimit TOUR  GEOJSON.COORDINATES GEOJSON.TYPE
1       TRUE           NULL -119.36000, 37.87111        Point
2       TRUE           NULL -119.27231, 37.96433        Point
3       TRUE           NULL   -119.0747, 37.7975        Point
4       TRUE           NULL -119.58607, 37.33328        Point
5       TRUE           NULL -119.54448, 37.42545        Point
6       TRUE           NULL -119.53736, 37.36749        Point</code></pre>
</div>
</div>
<section id="map-yosemite" class="level2">
<h2 class="anchored" data-anchor-id="map-yosemite">Map Yosemite</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe extractors</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>get_lon <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">length</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">1</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>get_lat <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">length</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">2</span>]</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lon/lat columns</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>facilities_df <span class="ot">&lt;-</span> facilities_df <span class="sc">%&gt;%</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">map_dbl</span>(GEOJSON.COORDINATES, get_lon),</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">map_dbl</span>(GEOJSON.COORDINATES, get_lat)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lon), <span class="sc">!</span><span class="fu">is.na</span>(lat))  <span class="co"># removes NULL rows</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Build interactive map centered on Yosemite</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(facilities_df) <span class="sc">%&gt;%</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>Esri.NatGeoWorldMap) <span class="sc">%&gt;%</span>  <span class="co"># prettier tile layer</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">119.5383</span>, <span class="at">lat =</span> <span class="fl">37.8651</span>, <span class="at">zoom =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">6</span>,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="st">"lightgreen"</span>,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.85</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Location&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Site:"</span>, FacilityName,<span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Coordinates&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Lat: "</span>, <span class="fu">round</span>(lat, <span class="dv">5</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Lon: "</span>, <span class="fu">round</span>(lon, <span class="dv">5</span>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-133ba802a8fd12547a47" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-133ba802a8fd12547a47">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.NatGeoWorldMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[37.8711111,37.964335,37.797504,37.333279,37.425452,37.367487,37.312674,37.82397,37.818951,38.477308,38.4802,37.7333333,38.477333,37.8211111,37.9855556,38.478305,37.7517,41.2338889,37.741426343,37.668233,37.309503,37.7638889,37.671086,37.783114,37.328579,37.8703,37.48967083,37.297464,38.0075,37.9838889,37.301819,38.4811,37.309554,37.818308],[-119.36,-119.27231,-119.074699,-119.586071,-119.544476,-119.537357,-119.57003,-120.00495,-120.093929,-120.024175,-119.985,-119.0166667,-120.008045,-120.0486111,-119.9169444,-120.00303,-119.7362,-121.9838889,-119.603357128,-119.839488,-119.547201,-119.8444444,-119.8362,-119.126491,-119.57993,-119.6483,-119.6323095,-119.534606,-120.5402778,-120.5080556,-119.541463,-120.017,-119.547104,-120.095702],6,null,null,{"interactive":true,"className":"","stroke":true,"color":"darkgreen","weight":1,"opacity":0.5,"fill":true,"fillColor":"lightgreen","fillOpacity":0.85},null,null,["<b>Location<\/b><br>Site:Tuolumne Meadows Campground<br><b>Coordinates<\/b><br>Lat: 37.87111<br>Lon: -119.36","<b>Location<\/b><br>Site:Saddlebag Lake Trailhead Group Camp<br><b>Coordinates<\/b><br>Lat: 37.96434<br>Lon: -119.27231","<b>Location<\/b><br>Site:OH RIDGE<br><b>Coordinates<\/b><br>Lat: 37.7975<br>Lon: -119.0747","<b>Location<\/b><br>Site:CRANE VALLEY<br><b>Coordinates<\/b><br>Lat: 37.33328<br>Lon: -119.58607","<b>Location<\/b><br>Site:TEXAS FLATS<br><b>Coordinates<\/b><br>Lat: 37.42545<br>Lon: -119.54448","<b>Location<\/b><br>Site:CHILKOOT<br><b>Coordinates<\/b><br>Lat: 37.36749<br>Lon: -119.53736","<b>Location<\/b><br>Site:Forks Campground (Sierra)<br><b>Coordinates<\/b><br>Lat: 37.31267<br>Lon: -119.57003","<b>Location<\/b><br>Site:Sweetwater (Stanislaus National Forest)<br><b>Coordinates<\/b><br>Lat: 37.82397<br>Lon: -120.00495","<b>Location<\/b><br>Site:Pines Stanislaus<br><b>Coordinates<\/b><br>Lat: 37.81895<br>Lon: -120.09393","<b>Location<\/b><br>Site:(Lake Alpine) Lodgepole Campground<br><b>Coordinates<\/b><br>Lat: 38.47731<br>Lon: -120.02418","<b>Location<\/b><br>Site:(LAKE ALPINE) SILVER VALLEY CAMPGROUND<br><b>Coordinates<\/b><br>Lat: 38.4802<br>Lon: -119.985","<b>Location<\/b><br>Site:OBSIDIAN FLAT<br><b>Coordinates<\/b><br>Lat: 37.73333<br>Lon: -119.01667","<b>Location<\/b><br>Site:(Lake Alpine) West Shore<br><b>Coordinates<\/b><br>Lat: 38.47733<br>Lon: -120.00804","<b>Location<\/b><br>Site:LOST CLAIM<br><b>Coordinates<\/b><br>Lat: 37.82111<br>Lon: -120.04861","<b>Location<\/b><br>Site:CHERRY VALLEY<br><b>Coordinates<\/b><br>Lat: 37.98556<br>Lon: -119.91694","<b>Location<\/b><br>Site:(Lake Alpine) Backpackers<br><b>Coordinates<\/b><br>Lat: 38.4783<br>Lon: -120.00303","<b>Location<\/b><br>Site:Tamarack Flat Campground<br><b>Coordinates<\/b><br>Lat: 37.7517<br>Lon: -119.7362","<b>Location<\/b><br>Site:CAMP 4 GROUP CAMPGROUND<br><b>Coordinates<\/b><br>Lat: 41.23389<br>Lon: -121.98389","<b>Location<\/b><br>Site:Camp 4<br><b>Coordinates<\/b><br>Lat: 37.74143<br>Lon: -119.60336","<b>Location<\/b><br>Site:DIRT FLAT<br><b>Coordinates<\/b><br>Lat: 37.66823<br>Lon: -119.83949","<b>Location<\/b><br>Site:LUPINE<br><b>Coordinates<\/b><br>Lat: 37.3095<br>Lon: -119.5472","<b>Location<\/b><br>Site:Crane Flat Campground<br><b>Coordinates<\/b><br>Lat: 37.76389<br>Lon: -119.84444","<b>Location<\/b><br>Site:DRY GULCH<br><b>Coordinates<\/b><br>Lat: 37.67109<br>Lon: -119.8362","<b>Location<\/b><br>Site:Silver Lake Campground June Lake (CA)<br><b>Coordinates<\/b><br>Lat: 37.78311<br>Lon: -119.12649","<b>Location<\/b><br>Site:RECREATION POINT<br><b>Coordinates<\/b><br>Lat: 37.32858<br>Lon: -119.57993","<b>Location<\/b><br>Site:White Wolf Campground<br><b>Coordinates<\/b><br>Lat: 37.8703<br>Lon: -119.6483","<b>Location<\/b><br>Site:SUMMERDALE CAMPGROUND<br><b>Coordinates<\/b><br>Lat: 37.48967<br>Lon: -119.63231","<b>Location<\/b><br>Site:WISHON BASS LAKE<br><b>Coordinates<\/b><br>Lat: 37.29746<br>Lon: -119.53461","<b>Location<\/b><br>Site:GLORY HOLE RECREATION AREA<br><b>Coordinates<\/b><br>Lat: 38.0075<br>Lon: -120.54028","<b>Location<\/b><br>Site:TUTTLETOWN RECREATION AREA<br><b>Coordinates<\/b><br>Lat: 37.98389<br>Lon: -120.50806","<b>Location<\/b><br>Site:SPRING COVE<br><b>Coordinates<\/b><br>Lat: 37.30182<br>Lon: -119.54146","<b>Location<\/b><br>Site:(LAKE ALPINE)  SILVER TIP CAMPGROUND<br><b>Coordinates<\/b><br>Lat: 38.4811<br>Lon: -120.017","<b>Location<\/b><br>Site:CEDAR BLUFF<br><b>Coordinates<\/b><br>Lat: 37.30955<br>Lon: -119.5471","<b>Location<\/b><br>Site:PINES GROUP STANISLAUS<br><b>Coordinates<\/b><br>Lat: 37.81831<br>Lon: -120.0957"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[37.8651,-119.5383],6,[]],"limits":{"lat":[37.297464,41.2338889],"lng":[-121.9838889,-119.0166667]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="reservations-data" class="level2">
<h2 class="anchored" data-anchor-id="reservations-data">Reservations Data</h2>
<p>Use this code to download the raw data for Yosemite. Use the map above to either explore different locations. You may choose to lower the number of sites to estimate.</p>
<p>From here you can start estimating a wtp following the steps listed above.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/loweas/ValuingNature/main/data/Yosemite.rds"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read directly from GitHub</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#readRDS from raw connection</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>reservations_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(url, <span class="st">"rb"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><img src="https://y.yarn.co/c3d73787-78a2-4e9f-b932-e5dfdb46bc3f_text.gif" class="img-fluid"></p>
<p><img src="https://64.media.tumblr.com/a2d3daadbf45c4d2903f82c5c5383f6b/tumblr_myg0klS5sR1snil4go2_250.gif" class="img-fluid"></p>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-methods1972" class="csl-entry" role="listitem">
<span>“Methods of Measuring the Demand for and Value of Outdoor Recreation. Marion Clawson. Resources for the Future, Inc., 1145 Nineteenth Street, N.W., Washington, D.C. 1959. 36p. 50c.”</span> 1972. <em>Travel Research Bulletin</em> 10 (3): 11–11. <a href="https://doi.org/10.1177/004728757201000331">https://doi.org/10.1177/004728757201000331</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Travel Cost"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "LoweMackenzie"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-09-21"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true        # Enables dropdown for code</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true       # (Optional) Adds buttons like "Show Code"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"  # (Optional) Custom label for dropdown</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Revealed Preferences: Travel Cost</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>The **Travel Cost Method (TCM)** is a commonly used approach to estimate the value of recreation sites. It was first suggested by [Harold Hotelling in a 1947 letter to the National Park Service](https://www.economia.unam.mx/profesores/blopez/valoracion-hotelling.pdf) and then further defined by Marion Clawson [@methods1972]. It provides a [**lower-bound estimate**]{.underline} of how much people value a site based on the cost they incur to visit.</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>There are two main types of TCM models:</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 1. Single-Site Models</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Focus on one specific location.</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use **Poisson regression** to estimate how many trips people take.</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>From this, you can calculate **consumer surplus** the benefit people get from visiting beyond what they pay.</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](images/Picture1.png)</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The cost of a trip includes actual expenses and the opportunity cost of travel time.</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These models are best when you want to estimate the total value of a site. For example, if a park is closed due to pollution or budget cuts and you want to estimate the loss in value from that closure.</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2. Multi-Site (or Multi-Attribute) Models</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Focus on multiple sites or on different features (attributes) of sites.</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use random utility models, typically estimated with a mixed logit (random parameter logit) model.</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These models help estimate how much people value different features, like trails, toilets, or accommodation.</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Useful for park planning, as they help managers decide which improvements provide the most value to visitors.</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Travel Cost Model (TCM)</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>General Steps in the Travel Cost Modeling Process:</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Define the site** to be evaluated</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Identify the types of recreation** and specify the relevant season</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Develop a sampling strategy** for data collection</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Specify the model**, including functional form and variables</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Determine how to handle multi-purpose trips** (i.e., trips with more than one goal)</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Design and conduct the visitor survey (get data from reservation system/ mobile data)**</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Measure trip costs**, including travel expenses and time value</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**Estimate the model** using the collected data</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>**Calculate the access value** by estimating **consumer surplus**</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Consumer Surplus</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>Consumer Surplus represents the area under the demand curve and above the actual price (travel cost) paid to access the park. This surplus reflects the net benefit or additional value visitors receive from their park experience beyond what they pay to get there. It is a commonly used metric for evaluating net recreational benefits.</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="fu"># Single Site</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>Also known as a count model. We will work thru the following example</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Define the site** :</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>    We will look at a park that is potentially impacted from a road closer along highway 101. This park cod be closed because of sea level rise and position of the road.</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](images/Screenshot%202025-10-05%20at%208.27.56%20PM.png)</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Identify the types of recreation** and specify the relevant season.</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>    It represents campers at a campground for a popular park on the Oregon Coast. This data set is specifically looking at the consumer surplus of camping at the park that would be loss if we donʻt do anything about the road.</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>    Currently the only factors we know is that the road repairs will cost a lot and the repairs will impact access to the beach.</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Develop a sampling strategy** for data collection</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>    For this project we will use the data from the reservation system which gives us information on every camper over the last 4 years.</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Specify the model**, including functional form and variables</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>Load in the following data. You can download it <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/loweas/ValuingNature/blob/main/park.csv)</span>. But the following code should grab it as well.</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE, eval=TRUE}</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>park <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://raw.githubusercontent.com/loweas/ValuingNature/refs/heads/main/park.csv"</span>)</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>Here are the variables</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a><span class="in">`sitetype`</span> The type of site within the park</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="in">`zcta5ce10`</span> zip code</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a><span class="in">`month`</span> month of reservation</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="in">`year`</span> Year of reservation</span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a><span class="in">`trip`</span> number of trips per zip code per month</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a><span class="in">`cost`</span> average cost per zip per month</span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a><span class="in">`income`</span> medium income for each year at the zipcode level</span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a><span class="in">`temp_avg`</span> average max temperature at the park in the given month</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a><span class="in">`mdays`</span> the average number of days stayed at the park per zip code.</span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>Lets take a look at the structure</span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(park<span class="sc">$</span>trip)</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(park<span class="sc">$</span>cost)</span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a>This distribution is clearly a count variable (non negative observations). The pick is close to our near to zero which means that we should consider a count model when dealing with the data.</span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Determine how to handle multi-purpose trips** (i.e., trips with more than one goal) For this specific example we will first explore the a simple model and then how the number of days spent impacts the overall value of the trip.</span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Design and conduct the visitor survey (get data from reservation system/ mobile data)**</span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Measure trip costs**, including travel expenses and time value</span>
<span id="cb23-147"><a href="#cb23-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-148"><a href="#cb23-148" aria-hidden="true" tabindex="-1"></a>    To get a distance measurement you can use online sources like <span class="co">[</span><span class="ot">OSRM</span><span class="co">](https://project-osrm.org/)</span>. We have already calculated it for this example but I have provide a code snippet for consideration.</span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a><span class="fu">### Travel Distance using OSRM</span></span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Load Libraries ---</span></span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a><span class="co"># Install these packages if you haven't already:</span></span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("tidyverse", "httr"))</span></span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-161"><a href="#cb23-161" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Configuration ---</span></span>
<span id="cb23-162"><a href="#cb23-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Public OSRM Demo Server URL for the Routing Service</span></span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a>OSRM_URL <span class="ot">&lt;-</span> <span class="st">"http://router.project-osrm.org/route/v1/driving/"</span></span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a>BATCH_DELAY <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># Delay between API calls (in seconds)</span></span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Core OSRM API Call Function ---</span></span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-168"><a href="#cb23-168" aria-hidden="true" tabindex="-1"></a>get_osrm_route <span class="ot">&lt;-</span> <span class="cf">function</span>(start_lon, start_lat, end_lon, end_lat) {</span>
<span id="cb23-169"><a href="#cb23-169" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Calls the OSRM API to get driving distance (meters) and duration (seconds).</span></span>
<span id="cb23-170"><a href="#cb23-170" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Note: OSRM requires coordinates in Lon,Lat order (Longitude first).</span></span>
<span id="cb23-171"><a href="#cb23-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-172"><a href="#cb23-172" aria-hidden="true" tabindex="-1"></a>  distance_m <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb23-173"><a href="#cb23-173" aria-hidden="true" tabindex="-1"></a>  duration_s <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb23-174"><a href="#cb23-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-175"><a href="#cb23-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for missing coordinates</span></span>
<span id="cb23-176"><a href="#cb23-176" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(start_lon) <span class="sc">||</span> <span class="fu">is.na</span>(start_lat) <span class="sc">||</span> <span class="fu">is.na</span>(end_lon) <span class="sc">||</span> <span class="fu">is.na</span>(end_lat)) {</span>
<span id="cb23-177"><a href="#cb23-177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Distance_m =</span> distance_m, <span class="at">Duration_s =</span> duration_s))</span>
<span id="cb23-178"><a href="#cb23-178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-179"><a href="#cb23-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-180"><a href="#cb23-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct the request URL (LON,LAT;LON,LAT)</span></span>
<span id="cb23-181"><a href="#cb23-181" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">paste0</span>(start_lon, <span class="st">","</span>, start_lat, <span class="st">";"</span>, end_lon, <span class="st">","</span>, end_lat)</span>
<span id="cb23-182"><a href="#cb23-182" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(OSRM_URL, coords, <span class="st">"?overview=false"</span>)</span>
<span id="cb23-183"><a href="#cb23-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-184"><a href="#cb23-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the API call</span></span>
<span id="cb23-185"><a href="#cb23-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-186"><a href="#cb23-186" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="fu">timeout</span>(<span class="dv">5</span>))</span>
<span id="cb23-187"><a href="#cb23-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(response) <span class="co"># Check for HTTP errors (like 400)</span></span>
<span id="cb23-188"><a href="#cb23-188" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb23-189"><a href="#cb23-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-190"><a href="#cb23-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for success and routes</span></span>
<span id="cb23-191"><a href="#cb23-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="sc">$</span>code <span class="sc">==</span> <span class="st">'Ok'</span> <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(data<span class="sc">$</span>routes) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb23-192"><a href="#cb23-192" aria-hidden="true" tabindex="-1"></a>      route <span class="ot">&lt;-</span> data<span class="sc">$</span>routes[[<span class="dv">1</span>]]</span>
<span id="cb23-193"><a href="#cb23-193" aria-hidden="true" tabindex="-1"></a>      distance_m <span class="ot">&lt;-</span> route<span class="sc">$</span>distance</span>
<span id="cb23-194"><a href="#cb23-194" aria-hidden="true" tabindex="-1"></a>      duration_s <span class="ot">&lt;-</span> route<span class="sc">$</span>duration</span>
<span id="cb23-195"><a href="#cb23-195" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-196"><a href="#cb23-196" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Handle OSRM internal errors (like 'NoRoute')</span></span>
<span id="cb23-197"><a href="#cb23-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"  -&gt; OSRM API returned:"</span>, data<span class="sc">$</span>code, <span class="st">"for coordinates:"</span>, coords))</span>
<span id="cb23-198"><a href="#cb23-198" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-199"><a href="#cb23-199" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-200"><a href="#cb23-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Catch connection or status errors</span></span>
<span id="cb23-201"><a href="#cb23-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"  -&gt; OSRM Request Error:"</span>, e))</span>
<span id="cb23-202"><a href="#cb23-202" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb23-203"><a href="#cb23-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-204"><a href="#cb23-204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results as a list</span></span>
<span id="cb23-205"><a href="#cb23-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Distance_m =</span> distance_m, <span class="at">Duration_s =</span> duration_s))</span>
<span id="cb23-206"><a href="#cb23-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-207"><a href="#cb23-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-208"><a href="#cb23-208" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Generic Main Function ---</span></span>
<span id="cb23-209"><a href="#cb23-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-210"><a href="#cb23-210" aria-hidden="true" tabindex="-1"></a>calculate_routes_from_dataframe <span class="ot">&lt;-</span> <span class="cf">function</span>(df, start_lon_col, start_lat_col, end_lon_col, end_lat_col) {</span>
<span id="cb23-211"><a href="#cb23-211" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Calculates OSRM routes between specified coordinate columns in a dataframe.</span></span>
<span id="cb23-212"><a href="#cb23-212" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb23-213"><a href="#cb23-213" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param df The input dataframe.</span></span>
<span id="cb23-214"><a href="#cb23-214" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param start_lon_col Name of the start longitude column (string).</span></span>
<span id="cb23-215"><a href="#cb23-215" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param start_lat_col Name of the start latitude column (string).</span></span>
<span id="cb23-216"><a href="#cb23-216" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param end_lon_col Name of the end longitude column (string).</span></span>
<span id="cb23-217"><a href="#cb23-217" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param end_lat_col Name of the end latitude column (string).</span></span>
<span id="cb23-218"><a href="#cb23-218" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @return The original dataframe with Distance_m and Duration_s columns appended.</span></span>
<span id="cb23-219"><a href="#cb23-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-220"><a href="#cb23-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Starting generic OSRM calculations for "</span>, <span class="fu">nrow</span>(df), <span class="st">" entries...</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-221"><a href="#cb23-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-222"><a href="#cb23-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if all columns exist</span></span>
<span id="cb23-223"><a href="#cb23-223" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(start_lon_col, start_lat_col, end_lon_col, end_lat_col)</span>
<span id="cb23-224"><a href="#cb23-224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(df))) {</span>
<span id="cb23-225"><a href="#cb23-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Required column(s) not found:"</span>, <span class="fu">paste</span>(<span class="fu">setdiff</span>(required_cols, <span class="fu">names</span>(df)), <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb23-226"><a href="#cb23-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-227"><a href="#cb23-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-228"><a href="#cb23-228" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Prepare data by selecting relevant columns, ensuring numeric, and removing NAs</span></span>
<span id="cb23-229"><a href="#cb23-229" aria-hidden="true" tabindex="-1"></a>  df_prepared <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb23-230"><a href="#cb23-230" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select only the relevant coordinate columns for the OSRM processing</span></span>
<span id="cb23-231"><a href="#cb23-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(required_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb23-232"><a href="#cb23-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">original_index =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb23-233"><a href="#cb23-233" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure all are numeric</span></span>
<span id="cb23-234"><a href="#cb23-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(required_cols), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb23-235"><a href="#cb23-235" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter only rows with valid coordinates</span></span>
<span id="cb23-236"><a href="#cb23-236" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_any</span>(<span class="fu">all_of</span>(required_cols), is.na))</span>
<span id="cb23-237"><a href="#cb23-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-238"><a href="#cb23-238" aria-hidden="true" tabindex="-1"></a>  total_processed <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_prepared)</span>
<span id="cb23-239"><a href="#cb23-239" aria-hidden="true" tabindex="-1"></a>  total_skipped <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df) <span class="sc">-</span> total_processed</span>
<span id="cb23-240"><a href="#cb23-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-241"><a href="#cb23-241" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (total_processed <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb23-242"><a href="#cb23-242" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"No valid coordinate pairs found. Returning original dataframe.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-243"><a href="#cb23-243" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Append NA columns to the original dataframe if no routes were processed</span></span>
<span id="cb23-244"><a href="#cb23-244" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Distance_m =</span> <span class="cn">NA_real_</span>, <span class="at">Duration_s =</span> <span class="cn">NA_real_</span>))</span>
<span id="cb23-245"><a href="#cb23-245" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-246"><a href="#cb23-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-247"><a href="#cb23-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"-&gt; Found "</span>, total_skipped, <span class="st">" entries with missing coordinates that will be skipped.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-248"><a href="#cb23-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"-&gt; Processing "</span>, total_processed, <span class="st">" valid entries now.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-249"><a href="#cb23-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-250"><a href="#cb23-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Iterate and Call OSRM API</span></span>
<span id="cb23-251"><a href="#cb23-251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-252"><a href="#cb23-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectors to store results for the rows being processed</span></span>
<span id="cb23-253"><a href="#cb23-253" aria-hidden="true" tabindex="-1"></a>  distance_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, total_processed)</span>
<span id="cb23-254"><a href="#cb23-254" aria-hidden="true" tabindex="-1"></a>  duration_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, total_processed)</span>
<span id="cb23-255"><a href="#cb23-255" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-256"><a href="#cb23-256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_processed) {</span>
<span id="cb23-257"><a href="#cb23-257" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> df_prepared[i, ]</span>
<span id="cb23-258"><a href="#cb23-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-259"><a href="#cb23-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">||</span> i <span class="sc">==</span> total_processed) {</span>
<span id="cb23-260"><a href="#cb23-260" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Processed row "</span>, i, <span class="st">"/"</span>, total_processed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-261"><a href="#cb23-261" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-262"><a href="#cb23-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-263"><a href="#cb23-263" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">get_osrm_route</span>(</span>
<span id="cb23-264"><a href="#cb23-264" aria-hidden="true" tabindex="-1"></a>      row[[start_lon_col]], row[[start_lat_col]], </span>
<span id="cb23-265"><a href="#cb23-265" aria-hidden="true" tabindex="-1"></a>      row[[end_lon_col]], row[[end_lat_col]]</span>
<span id="cb23-266"><a href="#cb23-266" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-267"><a href="#cb23-267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-268"><a href="#cb23-268" aria-hidden="true" tabindex="-1"></a>    distance_vec[i] <span class="ot">&lt;-</span> results<span class="sc">$</span>Distance_m</span>
<span id="cb23-269"><a href="#cb23-269" aria-hidden="true" tabindex="-1"></a>    duration_vec[i] <span class="ot">&lt;-</span> results<span class="sc">$</span>Duration_s</span>
<span id="cb23-270"><a href="#cb23-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-271"><a href="#cb23-271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(BATCH_DELAY)</span>
<span id="cb23-272"><a href="#cb23-272" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-273"><a href="#cb23-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-274"><a href="#cb23-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Merge results back to the original full dataframe</span></span>
<span id="cb23-275"><a href="#cb23-275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-276"><a href="#cb23-276" aria-hidden="true" tabindex="-1"></a>  df_results <span class="ot">&lt;-</span> df_prepared <span class="sc">%&gt;%</span></span>
<span id="cb23-277"><a href="#cb23-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(original_index) <span class="sc">%&gt;%</span></span>
<span id="cb23-278"><a href="#cb23-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-279"><a href="#cb23-279" aria-hidden="true" tabindex="-1"></a>      <span class="at">Distance_m =</span> distance_vec,</span>
<span id="cb23-280"><a href="#cb23-280" aria-hidden="true" tabindex="-1"></a>      <span class="at">Duration_s =</span> duration_vec</span>
<span id="cb23-281"><a href="#cb23-281" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-282"><a href="#cb23-282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-283"><a href="#cb23-283" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform a left join on the original row index</span></span>
<span id="cb23-284"><a href="#cb23-284" aria-hidden="true" tabindex="-1"></a>  df_final <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb23-285"><a href="#cb23-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">original_index =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb23-286"><a href="#cb23-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_results, <span class="at">by =</span> <span class="st">"original_index"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-287"><a href="#cb23-287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>original_index)</span>
<span id="cb23-288"><a href="#cb23-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-289"><a href="#cb23-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">========================================================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-290"><a href="#cb23-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Generic OSRM calculation complete. Returning augmented dataframe.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-291"><a href="#cb23-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-292"><a href="#cb23-292" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-293"><a href="#cb23-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df_final)</span>
<span id="cb23-294"><a href="#cb23-294" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-295"><a href="#cb23-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-296"><a href="#cb23-296" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Example Usage ---</span></span>
<span id="cb23-297"><a href="#cb23-297" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-298"><a href="#cb23-298" aria-hidden="true" tabindex="-1"></a><span class="co"># # 1. Create a dummy dataframe:</span></span>
<span id="cb23-299"><a href="#cb23-299" aria-hidden="true" tabindex="-1"></a><span class="co"># # my_data &lt;- tibble(</span></span>
<span id="cb23-300"><a href="#cb23-300" aria-hidden="true" tabindex="-1"></a><span class="co"># #   site_id = 1:3,</span></span>
<span id="cb23-301"><a href="#cb23-301" aria-hidden="true" tabindex="-1"></a><span class="co"># #   warehouse_lon = c(-157.8, -157.9, -158.0),</span></span>
<span id="cb23-302"><a href="#cb23-302" aria-hidden="true" tabindex="-1"></a><span class="co"># #   warehouse_lat = c(21.3, 21.4, 21.5),</span></span>
<span id="cb23-303"><a href="#cb23-303" aria-hidden="true" tabindex="-1"></a><span class="co"># #   customer_lon = c(-157.7, -157.8, NA), # NA added to test skipping</span></span>
<span id="cb23-304"><a href="#cb23-304" aria-hidden="true" tabindex="-1"></a><span class="co"># #   customer_lat = c(21.4, 21.5, 21.6)</span></span>
<span id="cb23-305"><a href="#cb23-305" aria-hidden="true" tabindex="-1"></a><span class="co"># # )</span></span>
<span id="cb23-306"><a href="#cb23-306" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb23-307"><a href="#cb23-307" aria-hidden="true" tabindex="-1"></a><span class="co"># # 2. Call the function, specifying your column names:</span></span>
<span id="cb23-308"><a href="#cb23-308" aria-hidden="true" tabindex="-1"></a><span class="co"># # result_df &lt;- calculate_routes_from_dataframe(</span></span>
<span id="cb23-309"><a href="#cb23-309" aria-hidden="true" tabindex="-1"></a><span class="co"># #   df = my_data,</span></span>
<span id="cb23-310"><a href="#cb23-310" aria-hidden="true" tabindex="-1"></a><span class="co"># #   start_lon_col = "warehouse_lon",</span></span>
<span id="cb23-311"><a href="#cb23-311" aria-hidden="true" tabindex="-1"></a><span class="co"># #   start_lat_col = "warehouse_lat",</span></span>
<span id="cb23-312"><a href="#cb23-312" aria-hidden="true" tabindex="-1"></a><span class="co"># #   end_lon_col = "customer_lon",</span></span>
<span id="cb23-313"><a href="#cb23-313" aria-hidden="true" tabindex="-1"></a><span class="co"># #   end_lat_col = "customer_lat"</span></span>
<span id="cb23-314"><a href="#cb23-314" aria-hidden="true" tabindex="-1"></a><span class="co"># # )</span></span>
<span id="cb23-315"><a href="#cb23-315" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-316"><a href="#cb23-316" aria-hidden="true" tabindex="-1"></a><span class="co"># # The result will have the original columns plus Distance_m and Duration_s.</span></span>
<span id="cb23-317"><a href="#cb23-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-318"><a href="#cb23-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-319"><a href="#cb23-319" aria-hidden="true" tabindex="-1"></a>Thank for use the data has the travel distance already calculated for each zip code in the dataset.</span>
<span id="cb23-320"><a href="#cb23-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-321"><a href="#cb23-321" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**Estimate the model** using the collected data</span>
<span id="cb23-322"><a href="#cb23-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-323"><a href="#cb23-323" aria-hidden="true" tabindex="-1"></a>We are using a zonal method to calculate the trips. Zonal travel cost means that for each location ID you are measuring the distance to park. The location ID is a zip code case.</span>
<span id="cb23-324"><a href="#cb23-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-325"><a href="#cb23-325" aria-hidden="true" tabindex="-1"></a>A Poisson model (specifically <span class="co">[</span><span class="ot">Poisson regression</span><span class="co">]</span>{.underline}) is a type of generalized linear model (GLM) designed to model count data. This is where the response variable represents counts of events (e.g., number of trips, visits, accidents).</span>
<span id="cb23-326"><a href="#cb23-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-327"><a href="#cb23-327" aria-hidden="true" tabindex="-1"></a>This model accounts for the following:</span>
<span id="cb23-328"><a href="#cb23-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-329"><a href="#cb23-329" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Count outcomes (non-negative integers)</span>
<span id="cb23-330"><a href="#cb23-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-331"><a href="#cb23-331" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Models outcomes like 0, 1, 2, 3...</span>
<span id="cb23-332"><a href="#cb23-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-333"><a href="#cb23-333" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Cannot produce negative predictions.</span>
<span id="cb23-334"><a href="#cb23-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-335"><a href="#cb23-335" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The fact that the variance equals the mean</span>
<span id="cb23-336"><a href="#cb23-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-337"><a href="#cb23-337" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>In a Poisson distribution, the mean (μ) is equal to the variance (σ²).</span>
<span id="cb23-338"><a href="#cb23-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-339"><a href="#cb23-339" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This is a key assumption of the model:</span>
<span id="cb23-340"><a href="#cb23-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-341"><a href="#cb23-341" aria-hidden="true" tabindex="-1"></a>        $$ Var(Y)=E(Y) $$</span>
<span id="cb23-342"><a href="#cb23-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-343"><a href="#cb23-343" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Skewed distribution</span>
<span id="cb23-344"><a href="#cb23-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-345"><a href="#cb23-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Count data are often right-skewed (many small values, few large ones), which the Poisson model handles better than linear regression.</span>
<span id="cb23-346"><a href="#cb23-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-347"><a href="#cb23-347" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Log-linear relationship between predictors and expected counts</span>
<span id="cb23-348"><a href="#cb23-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-349"><a href="#cb23-349" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The model assumes a logarithmic link between the mean of the outcome and the predictors:</span>
<span id="cb23-350"><a href="#cb23-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-351"><a href="#cb23-351" aria-hidden="true" tabindex="-1"></a>        $$log⁡(μ)=β0+β1X1+β2X2+…e$$</span>
<span id="cb23-352"><a href="#cb23-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-353"><a href="#cb23-353" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Independent events**</span>
<span id="cb23-354"><a href="#cb23-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-355"><a href="#cb23-355" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each event (e.g., each person's number of trips) is assumed to be **independent** of others.</span>
<span id="cb23-356"><a href="#cb23-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-357"><a href="#cb23-357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Count Model</span></span>
<span id="cb23-358"><a href="#cb23-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-359"><a href="#cb23-359" aria-hidden="true" tabindex="-1"></a>Simple cost and the decision of a trip</span>
<span id="cb23-360"><a href="#cb23-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-363"><a href="#cb23-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-364"><a href="#cb23-364" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">=</span><span class="fu">glm</span>(trip <span class="sc">~</span> cost, </span>
<span id="cb23-365"><a href="#cb23-365" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> park, </span>
<span id="cb23-366"><a href="#cb23-366" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb23-367"><a href="#cb23-367" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span>
<span id="cb23-368"><a href="#cb23-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-369"><a href="#cb23-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-370"><a href="#cb23-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-371"><a href="#cb23-371" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>**Calculate the access value** by estimating **consumer surplus**</span>
<span id="cb23-372"><a href="#cb23-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-373"><a href="#cb23-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple WTP</span></span>
<span id="cb23-374"><a href="#cb23-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-377"><a href="#cb23-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-378"><a href="#cb23-378" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>model1<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb23-379"><a href="#cb23-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-380"><a href="#cb23-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-381"><a href="#cb23-381" aria-hidden="true" tabindex="-1"></a>The interpretation suggest that on average the consumer surplus for each person who camps at this park is on average \$368.</span>
<span id="cb23-382"><a href="#cb23-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-383"><a href="#cb23-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## More Controls</span></span>
<span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a>Multiple variable regression: Controlling for more factors in the model</span>
<span id="cb23-386"><a href="#cb23-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">glm</span>(trip <span class="sc">~</span> cost <span class="sc">+</span> income<span class="sc">+</span><span class="fu">factor</span>(year)<span class="sc">+</span>temp_avg<span class="sc">+</span>mdays<span class="sc">+</span><span class="fu">factor</span>(sitetype), </span>
<span id="cb23-391"><a href="#cb23-391" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> park, </span>
<span id="cb23-392"><a href="#cb23-392" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb23-393"><a href="#cb23-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-394"><a href="#cb23-394" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb23-395"><a href="#cb23-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-396"><a href="#cb23-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-397"><a href="#cb23-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### WTP</span></span>
<span id="cb23-398"><a href="#cb23-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-401"><a href="#cb23-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-402"><a href="#cb23-402" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>model2<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb23-403"><a href="#cb23-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-404"><a href="#cb23-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-405"><a href="#cb23-405" aria-hidden="true" tabindex="-1"></a>We can see with more controls our measurement reduces and is more conservative.</span>
<span id="cb23-406"><a href="#cb23-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-407"><a href="#cb23-407" aria-hidden="true" tabindex="-1"></a>The consumer surplus is now around \$302 per person.</span>
<span id="cb23-408"><a href="#cb23-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-409"><a href="#cb23-409" aria-hidden="true" tabindex="-1"></a>From here you could take the sum of the season or year and calculate the WTP for this specific site. For example, a policy in which the park will impacted the park, funding for park, etc. This is helpful in estimating the total use value (consumer surplus) of one site.</span>
<span id="cb23-410"><a href="#cb23-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-411"><a href="#cb23-411" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multi-Site</span></span>
<span id="cb23-412"><a href="#cb23-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-413"><a href="#cb23-413" aria-hidden="true" tabindex="-1"></a>A single site has a lot of caveats, however. You canʻt say much about what the impacts are to other parks. People may just trade-off to go to a different park and look at sites as a package.</span>
<span id="cb23-414"><a href="#cb23-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-415"><a href="#cb23-415" aria-hidden="true" tabindex="-1"></a>In that cause we use a **multi-site approach** by estimating demand systems, comparing multiple sites, and valuing changes in site characteristics or policy scenarios.</span>
<span id="cb23-416"><a href="#cb23-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-417"><a href="#cb23-417" aria-hidden="true" tabindex="-1"></a>Use **multi-site models** when:</span>
<span id="cb23-418"><a href="#cb23-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-419"><a href="#cb23-419" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You want to evaluate relative site quality or rank sites.</span>
<span id="cb23-420"><a href="#cb23-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-421"><a href="#cb23-421" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You have data on multiple alternative sites and want to understand visitor choice behavior.</span>
<span id="cb23-422"><a href="#cb23-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-423"><a href="#cb23-423" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You're interested in estimating marginal values of site attributes (e.g., distance, facilities, congestion).</span>
<span id="cb23-424"><a href="#cb23-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-425"><a href="#cb23-425" aria-hidden="true" tabindex="-1"></a>Common models used:</span>
<span id="cb23-426"><a href="#cb23-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-427"><a href="#cb23-427" aria-hidden="true" tabindex="-1"></a><span class="fu">##   Random Utility Models (RUMs) </span></span>
<span id="cb23-428"><a href="#cb23-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-431"><a href="#cb23-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-432"><a href="#cb23-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-433"><a href="#cb23-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-434"><a href="#cb23-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-435"><a href="#cb23-435" aria-hidden="true" tabindex="-1"></a><span class="fu"># NREM 691 Fall 2025</span></span>
<span id="cb23-436"><a href="#cb23-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-437"><a href="#cb23-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE, eval=TRUE}</span></span>
<span id="cb23-438"><a href="#cb23-438" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Load Libraries ---</span></span>
<span id="cb23-439"><a href="#cb23-439" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb23-440"><a href="#cb23-440" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb23-441"><a href="#cb23-441" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb23-442"><a href="#cb23-442" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb23-443"><a href="#cb23-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-444"><a href="#cb23-444" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Configuration ---</span></span>
<span id="cb23-445"><a href="#cb23-445" aria-hidden="true" tabindex="-1"></a>API_KEY <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"RIDB_API_KEY"</span>)</span>
<span id="cb23-446"><a href="#cb23-446" aria-hidden="true" tabindex="-1"></a>RIDB_BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://ridb.recreation.gov/api/v1/"</span></span>
<span id="cb23-447"><a href="#cb23-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-448"><a href="#cb23-448" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Core API Function ---</span></span>
<span id="cb23-449"><a href="#cb23-449" aria-hidden="true" tabindex="-1"></a>query_ridb <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">endpoint =</span> <span class="st">"facilities"</span>, <span class="at">search_term =</span> <span class="cn">NULL</span>, <span class="at">api_key =</span> API_KEY, <span class="at">limit =</span> <span class="dv">50</span>) {</span>
<span id="cb23-450"><a href="#cb23-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(RIDB_BASE_URL, endpoint)</span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a>  query_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> api_key,</span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">limit =</span> limit</span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(search_term)) {</span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a>    query_params<span class="sc">$</span>query <span class="ot">&lt;-</span> search_term</span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-462"><a href="#cb23-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Fetching data from: "</span>, url, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-463"><a href="#cb23-463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb23-465"><a href="#cb23-465" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> query_params)</span>
<span id="cb23-466"><a href="#cb23-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(response)</span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a>    content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb23-469"><a href="#cb23-469" aria-hidden="true" tabindex="-1"></a>    data_list <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(content, <span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-470"><a href="#cb23-470" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-471"><a href="#cb23-471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"RECDATA"</span> <span class="sc">%in%</span> <span class="fu">names</span>(data_list) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(data_list<span class="sc">$</span>RECDATA)) {</span>
<span id="cb23-472"><a href="#cb23-472" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"Successfully retrieved "</span>, <span class="fu">nrow</span>(data_list<span class="sc">$</span>RECDATA), <span class="st">" records.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-473"><a href="#cb23-473" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(data_list<span class="sc">$</span>RECDATA)</span>
<span id="cb23-474"><a href="#cb23-474" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-475"><a href="#cb23-475" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Warning: API response structure unexpected. No 'RECDATA' found.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-476"><a href="#cb23-476" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb23-477"><a href="#cb23-477" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-478"><a href="#cb23-478" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-479"><a href="#cb23-479" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-480"><a href="#cb23-480" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"An error occurred during the API call: "</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb23-481"><a href="#cb23-481" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb23-482"><a href="#cb23-482" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb23-483"><a href="#cb23-483" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-484"><a href="#cb23-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-485"><a href="#cb23-485" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Example Usage ---</span></span>
<span id="cb23-486"><a href="#cb23-486" aria-hidden="true" tabindex="-1"></a>facilities_df <span class="ot">&lt;-</span> <span class="fu">query_ridb</span>(</span>
<span id="cb23-487"><a href="#cb23-487" aria-hidden="true" tabindex="-1"></a>  <span class="at">endpoint =</span> <span class="st">"facilities"</span>,</span>
<span id="cb23-488"><a href="#cb23-488" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_term =</span> <span class="st">"Yosemite National Park camping"</span>,</span>
<span id="cb23-489"><a href="#cb23-489" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">100</span></span>
<span id="cb23-490"><a href="#cb23-490" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-491"><a href="#cb23-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-492"><a href="#cb23-492" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Inspect Results ---</span></span>
<span id="cb23-493"><a href="#cb23-493" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(facilities_df)) {</span>
<span id="cb23-494"><a href="#cb23-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Structure of the Results ---</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-495"><a href="#cb23-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(facilities_df))</span>
<span id="cb23-496"><a href="#cb23-496" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-497"><a href="#cb23-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Map Yosemite</span></span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe extractors</span></span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a>get_lon <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-510"><a href="#cb23-510" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">length</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb23-511"><a href="#cb23-511" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">1</span>]</span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a>get_lat <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">length</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a>  x[<span class="dv">2</span>]</span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-519"><a href="#cb23-519" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lon/lat columns</span></span>
<span id="cb23-520"><a href="#cb23-520" aria-hidden="true" tabindex="-1"></a>facilities_df <span class="ot">&lt;-</span> facilities_df <span class="sc">%&gt;%</span></span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">map_dbl</span>(GEOJSON.COORDINATES, get_lon),</span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">map_dbl</span>(GEOJSON.COORDINATES, get_lat)</span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lon), <span class="sc">!</span><span class="fu">is.na</span>(lat))  <span class="co"># removes NULL rows</span></span>
<span id="cb23-526"><a href="#cb23-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-527"><a href="#cb23-527" aria-hidden="true" tabindex="-1"></a><span class="co"># Build interactive map centered on Yosemite</span></span>
<span id="cb23-528"><a href="#cb23-528" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(facilities_df) <span class="sc">%&gt;%</span></span>
<span id="cb23-529"><a href="#cb23-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>Esri.NatGeoWorldMap) <span class="sc">%&gt;%</span>  <span class="co"># prettier tile layer</span></span>
<span id="cb23-530"><a href="#cb23-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>(<span class="at">lng =</span> <span class="sc">-</span><span class="fl">119.5383</span>, <span class="at">lat =</span> <span class="fl">37.8651</span>, <span class="at">zoom =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-531"><a href="#cb23-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb23-532"><a href="#cb23-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>lon,</span>
<span id="cb23-533"><a href="#cb23-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb23-534"><a href="#cb23-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="dv">6</span>,</span>
<span id="cb23-535"><a href="#cb23-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb23-536"><a href="#cb23-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb23-537"><a href="#cb23-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillColor =</span> <span class="st">"lightgreen"</span>,</span>
<span id="cb23-538"><a href="#cb23-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.85</span>,</span>
<span id="cb23-539"><a href="#cb23-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb23-540"><a href="#cb23-540" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Location&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb23-541"><a href="#cb23-541" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Site:"</span>, FacilityName,<span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb23-542"><a href="#cb23-542" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;Coordinates&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb23-543"><a href="#cb23-543" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Lat: "</span>, <span class="fu">round</span>(lat, <span class="dv">5</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb23-544"><a href="#cb23-544" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Lon: "</span>, <span class="fu">round</span>(lon, <span class="dv">5</span>)</span>
<span id="cb23-545"><a href="#cb23-545" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb23-546"><a href="#cb23-546" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-547"><a href="#cb23-547" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-548"><a href="#cb23-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-549"><a href="#cb23-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-550"><a href="#cb23-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-551"><a href="#cb23-551" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reservations Data</span></span>
<span id="cb23-552"><a href="#cb23-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-553"><a href="#cb23-553" aria-hidden="true" tabindex="-1"></a>Use this code to download the raw data for Yosemite. Use the map above to either explore different locations. You may choose to lower the number of sites to estimate. </span>
<span id="cb23-554"><a href="#cb23-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-555"><a href="#cb23-555" aria-hidden="true" tabindex="-1"></a>From here you can start estimating a wtp following the steps listed above. </span>
<span id="cb23-556"><a href="#cb23-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-557"><a href="#cb23-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE, eval=TRUE}</span></span>
<span id="cb23-558"><a href="#cb23-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-559"><a href="#cb23-559" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/loweas/ValuingNature/main/data/Yosemite.rds"</span></span>
<span id="cb23-560"><a href="#cb23-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-561"><a href="#cb23-561" aria-hidden="true" tabindex="-1"></a><span class="co"># Read directly from GitHub</span></span>
<span id="cb23-562"><a href="#cb23-562" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb23-563"><a href="#cb23-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-564"><a href="#cb23-564" aria-hidden="true" tabindex="-1"></a><span class="co">#readRDS from raw connection</span></span>
<span id="cb23-565"><a href="#cb23-565" aria-hidden="true" tabindex="-1"></a>reservations_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(url, <span class="st">"rb"</span>))</span>
<span id="cb23-566"><a href="#cb23-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-567"><a href="#cb23-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-568"><a href="#cb23-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-569"><a href="#cb23-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-570"><a href="#cb23-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-571"><a href="#cb23-571" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://y.yarn.co/c3d73787-78a2-4e9f-b932-e5dfdb46bc3f_text.gif)</span></span>
<span id="cb23-572"><a href="#cb23-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-573"><a href="#cb23-573" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://64.media.tumblr.com/a2d3daadbf45c4d2903f82c5c5383f6b/tumblr_myg0klS5sR1snil4go2_250.gif)</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>